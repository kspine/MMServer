<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.6">
  <compounddef id="_src_2_town_server_8cpp" kind="file">
    <compoundname>TownServer.cpp</compoundname>
    <includes refid="_src_2_town_server_8h" local="yes">TownServer.h</includes>
    <incdepgraph>
      <node id="66038">
        <label>SeCommStream.h</label>
        <link refid="_se_comm_stream_8h"/>
        <childnode refid="66027" relation="include">
        </childnode>
        <childnode refid="66021" relation="include">
        </childnode>
      </node>
      <node id="66008">
        <label>list</label>
      </node>
      <node id="66002">
        <label>locale</label>
      </node>
      <node id="66012">
        <label>queue</label>
      </node>
      <node id="66006">
        <label>limits</label>
      </node>
      <node id="66021">
        <label>SePtlCommDefine.h</label>
        <link refid="_se_ptl_comm_define_8h"/>
      </node>
      <node id="66019">
        <label>SeMemPool.h</label>
        <link refid="_se_mem_pool_8h"/>
        <childnode refid="65987" relation="include">
        </childnode>
        <childnode refid="66020" relation="include">
        </childnode>
        <childnode refid="65994" relation="include">
        </childnode>
      </node>
      <node id="65989">
        <label>windows.h</label>
      </node>
      <node id="65994">
        <label>assert.h</label>
      </node>
      <node id="66058">
        <label>SeRaceCmd.h</label>
        <link refid="_se_race_cmd_8h"/>
        <childnode refid="66018" relation="include">
        </childnode>
        <childnode refid="66027" relation="include">
        </childnode>
      </node>
      <node id="66070">
        <label>SeWCMSTProcess.inl</label>
        <link refid="_se_w_c_m_s_t_process_8inl"/>
      </node>
      <node id="66043">
        <label>SeDBDefine.h</label>
        <link refid="_se_d_b_define_8h"/>
        <childnode refid="66027" relation="include">
        </childnode>
      </node>
      <node id="65992">
        <label>stdlib.h</label>
      </node>
      <node id="66020">
        <label>EsLock.h</label>
      </node>
      <node id="66071">
        <label>SeTWCMSSend.inl</label>
        <link refid="_se_t_w_c_m_s_send_8inl"/>
      </node>
      <node id="65996">
        <label>cmath</label>
      </node>
      <node id="66005">
        <label>string</label>
      </node>
      <node id="66009">
        <label>map</label>
      </node>
      <node id="66047">
        <label>SeFileLog.h</label>
        <link refid="_se_file_log_8h"/>
        <childnode refid="66048" relation="include">
        </childnode>
        <childnode refid="65998" relation="include">
        </childnode>
        <childnode refid="66020" relation="include">
        </childnode>
      </node>
      <node id="65991">
        <label>conio.h</label>
      </node>
      <node id="66073">
        <label>SeNTProcess.inl</label>
        <link refid="_se_n_t_process_8inl"/>
      </node>
      <node id="66028">
        <label>SePtlRandomNumDef.h</label>
        <link refid="_se_ptl_random_num_def_8h"/>
      </node>
      <node id="65990">
        <label>direct.h</label>
      </node>
      <node id="66031">
        <label>SePtl_TS_To_CL.h</label>
        <link refid="_se_ptl___t_s___to___c_l_8h"/>
        <childnode refid="66027" relation="include">
        </childnode>
        <childnode refid="66021" relation="include">
        </childnode>
      </node>
      <node id="66003">
        <label>fstream</label>
      </node>
      <node id="66023">
        <label>SeTool.h</label>
        <link refid="_se_tool_8h"/>
        <childnode refid="65987" relation="include">
        </childnode>
        <childnode refid="66016" relation="include">
        </childnode>
        <childnode refid="66024" relation="include">
        </childnode>
        <childnode refid="66018" relation="include">
        </childnode>
        <childnode refid="66000" relation="include">
        </childnode>
        <childnode refid="66025" relation="include">
        </childnode>
      </node>
      <node id="65988">
        <label>winsock2.h</label>
      </node>
      <node id="66052">
        <label>SeDBStream.h</label>
        <link refid="_se_d_b_stream_8h"/>
        <childnode refid="65987" relation="include">
        </childnode>
        <childnode refid="66043" relation="include">
        </childnode>
        <childnode refid="66022" relation="include">
        </childnode>
        <childnode refid="66027" relation="include">
        </childnode>
        <childnode refid="66053" relation="include">
        </childnode>
      </node>
      <node id="66051">
        <label>SePlayerDef.h</label>
        <link refid="_town_server_2_src_2_se_player_def_8h"/>
        <childnode refid="66027" relation="include">
        </childnode>
        <childnode refid="66043" relation="include">
        </childnode>
        <childnode refid="66030" relation="include">
        </childnode>
        <childnode refid="66022" relation="include">
        </childnode>
        <childnode refid="66046" relation="include">
        </childnode>
        <childnode refid="66019" relation="include">
        </childnode>
      </node>
      <node id="66060">
        <label>SeServerMainDef.h</label>
        <link refid="_se_server_main_def_8h"/>
        <childnode refid="65987" relation="include">
        </childnode>
      </node>
      <node id="66018">
        <label>TeMisc.h</label>
        <link refid="_te_misc_8h"/>
        <childnode refid="65999" relation="include">
        </childnode>
      </node>
      <node id="66022">
        <label>SeServerDefine.h</label>
        <link refid="_se_server_define_8h"/>
        <childnode refid="66016" relation="include">
        </childnode>
        <childnode refid="66017" relation="include">
        </childnode>
        <childnode refid="66023" relation="include">
        </childnode>
      </node>
      <node id="66061">
        <label>SeTWSend.inl</label>
        <link refid="_se_t_w_send_8inl"/>
      </node>
      <node id="65999">
        <label>string.h</label>
      </node>
      <node id="66054">
        <label>SePlayer.inl</label>
        <link refid="_town_server_2_src_2_se_player_8inl"/>
      </node>
      <node id="66035">
        <label>SePtl_WCMS_To_TS.h</label>
        <link refid="_se_ptl___w_c_m_s___to___t_s_8h"/>
        <childnode refid="66027" relation="include">
        </childnode>
      </node>
      <node id="66034">
        <label>SePtl_TCP_AND_TOWN.h</label>
        <link refid="_se_ptl___t_c_p___a_n_d___t_o_w_n_8h"/>
        <childnode refid="66027" relation="include">
        </childnode>
      </node>
      <node id="66053">
        <label>SeDBVariant.h</label>
        <link refid="_se_d_b_variant_8h"/>
        <childnode refid="66000" relation="include">
        </childnode>
        <childnode refid="66043" relation="include">
        </childnode>
      </node>
      <node id="66045">
        <label>SeConfig.h</label>
        <link refid="_se_config_8h"/>
        <childnode refid="66016" relation="include">
        </childnode>
      </node>
      <node id="65997">
        <label>ctime</label>
      </node>
      <node id="66029">
        <label>SePtl_TS_To_WS.h</label>
        <link refid="_se_ptl___t_s___to___w_s_8h"/>
        <childnode refid="66027" relation="include">
        </childnode>
      </node>
      <node id="66026">
        <label>SePtl_WS_To_TS.h</label>
        <link refid="_se_ptl___w_s___to___t_s_8h"/>
        <childnode refid="66027" relation="include">
        </childnode>
      </node>
      <node id="66017">
        <label>TeNetMgr.h</label>
      </node>
      <node id="66062">
        <label>SeTCSend.inl</label>
        <link refid="_se_t_c_send_8inl"/>
      </node>
      <node id="66030">
        <label>SePtl_CL_To_TS.h</label>
        <link refid="_se_ptl___c_l___to___t_s_8h"/>
        <childnode refid="66027" relation="include">
        </childnode>
        <childnode refid="66021" relation="include">
        </childnode>
      </node>
      <node id="66067">
        <label>SeCTProcess.inl</label>
        <link refid="_se_c_t_process_8inl"/>
      </node>
      <node id="66007">
        <label>vector</label>
      </node>
      <node id="66055">
        <label>SeRaceMgr.h</label>
        <link refid="_town_server_2_src_2_se_race_mgr_8h"/>
        <childnode refid="66056" relation="include">
        </childnode>
      </node>
      <node id="66013">
        <label>new</label>
      </node>
      <node id="66027">
        <label>SePtlDefine.h</label>
        <link refid="_se_ptl_define_8h"/>
        <childnode refid="65987" relation="include">
        </childnode>
        <childnode refid="66016" relation="include">
        </childnode>
        <childnode refid="66023" relation="include">
        </childnode>
        <childnode refid="66028" relation="include">
        </childnode>
        <childnode refid="66021" relation="include">
        </childnode>
        <childnode refid="66019" relation="include">
        </childnode>
      </node>
      <node id="66016">
        <label>SeShareDef.h</label>
        <link refid="_se_share_def_8h"/>
        <childnode refid="65987" relation="include">
        </childnode>
      </node>
      <node id="66004">
        <label>sstream</label>
      </node>
      <node id="66063">
        <label>SeTMSend.inl</label>
        <link refid="_se_t_m_send_8inl"/>
      </node>
      <node id="66025">
        <label>EsString.h</label>
      </node>
      <node id="66074">
        <label>SeTBLSend.inl</label>
        <link refid="_se_t_b_l_send_8inl"/>
      </node>
      <node id="66065">
        <label>SeTownOther.inl</label>
        <link refid="_src_2_se_town_other_8inl"/>
      </node>
      <node id="66056">
        <label>SeRaceMgrDef.h</label>
        <link refid="_town_server_2_src_2_se_race_mgr_def_8h"/>
        <childnode refid="65987" relation="include">
        </childnode>
        <childnode refid="66027" relation="include">
        </childnode>
        <childnode refid="66057" relation="include">
        </childnode>
        <childnode refid="66018" relation="include">
        </childnode>
        <childnode refid="66030" relation="include">
        </childnode>
        <childnode refid="66019" relation="include">
        </childnode>
        <childnode refid="66050" relation="include">
        </childnode>
      </node>
      <node id="65987">
        <label>SeInclude.h</label>
        <link refid="_se_include_8h"/>
        <childnode refid="65988" relation="include">
        </childnode>
        <childnode refid="65989" relation="include">
        </childnode>
        <childnode refid="65990" relation="include">
        </childnode>
        <childnode refid="65991" relation="include">
        </childnode>
        <childnode refid="65992" relation="include">
        </childnode>
        <childnode refid="65993" relation="include">
        </childnode>
        <childnode refid="65994" relation="include">
        </childnode>
        <childnode refid="65995" relation="include">
        </childnode>
        <childnode refid="65996" relation="include">
        </childnode>
        <childnode refid="65997" relation="include">
        </childnode>
        <childnode refid="65998" relation="include">
        </childnode>
        <childnode refid="65999" relation="include">
        </childnode>
        <childnode refid="66000" relation="include">
        </childnode>
        <childnode refid="66001" relation="include">
        </childnode>
        <childnode refid="66002" relation="include">
        </childnode>
        <childnode refid="66003" relation="include">
        </childnode>
        <childnode refid="66004" relation="include">
        </childnode>
        <childnode refid="66005" relation="include">
        </childnode>
        <childnode refid="66006" relation="include">
        </childnode>
        <childnode refid="66007" relation="include">
        </childnode>
        <childnode refid="66008" relation="include">
        </childnode>
        <childnode refid="66009" relation="include">
        </childnode>
        <childnode refid="66010" relation="include">
        </childnode>
        <childnode refid="66011" relation="include">
        </childnode>
        <childnode refid="66012" relation="include">
        </childnode>
        <childnode refid="66013" relation="include">
        </childnode>
        <childnode refid="66014" relation="include">
        </childnode>
      </node>
      <node id="66048">
        <label>time.h</label>
      </node>
      <node id="65993">
        <label>math.h</label>
      </node>
      <node id="66039">
        <label>SeTCStream.h</label>
        <link refid="_se_t_c_stream_8h"/>
        <childnode refid="66027" relation="include">
        </childnode>
        <childnode refid="66031" relation="include">
        </childnode>
        <childnode refid="66038" relation="include">
        </childnode>
      </node>
      <node id="66000">
        <label>EsType.h</label>
      </node>
      <node id="65986">
        <label>TownServer.h</label>
        <link refid="_src_2_town_server_8h"/>
        <childnode refid="65987" relation="include">
        </childnode>
        <childnode refid="66015" relation="include">
        </childnode>
        <childnode refid="66022" relation="include">
        </childnode>
        <childnode refid="66045" relation="include">
        </childnode>
        <childnode refid="66027" relation="include">
        </childnode>
        <childnode refid="66046" relation="include">
        </childnode>
        <childnode refid="66047" relation="include">
        </childnode>
        <childnode refid="66049" relation="include">
        </childnode>
        <childnode refid="66055" relation="include">
        </childnode>
        <childnode refid="66060" relation="include">
        </childnode>
        <childnode refid="66061" relation="include">
        </childnode>
        <childnode refid="66062" relation="include">
        </childnode>
        <childnode refid="66063" relation="include">
        </childnode>
        <childnode refid="66064" relation="include">
        </childnode>
        <childnode refid="66065" relation="include">
        </childnode>
        <childnode refid="66066" relation="include">
        </childnode>
        <childnode refid="66067" relation="include">
        </childnode>
        <childnode refid="66068" relation="include">
        </childnode>
        <childnode refid="66069" relation="include">
        </childnode>
        <childnode refid="66070" relation="include">
        </childnode>
        <childnode refid="66071" relation="include">
        </childnode>
        <childnode refid="66072" relation="include">
        </childnode>
        <childnode refid="66073" relation="include">
        </childnode>
        <childnode refid="66074" relation="include">
        </childnode>
        <childnode refid="66075" relation="include">
        </childnode>
      </node>
      <node id="66049">
        <label>SePlayerMgr.h</label>
        <link refid="_src_2_se_player_mgr_8h"/>
        <childnode refid="66050" relation="include">
        </childnode>
        <childnode refid="66015" relation="include">
        </childnode>
      </node>
      <node id="65995">
        <label>cctype</label>
      </node>
      <node id="66075">
        <label>SeBLTProcess.inl</label>
        <link refid="_se_b_l_t_process_8inl"/>
      </node>
      <node id="66024">
        <label>SeToolTemplate.inl</label>
        <link refid="_se_tool_template_8inl"/>
      </node>
      <node id="66041">
        <label>SePtl_NS_To_TS.h</label>
        <link refid="_se_ptl___n_s___to___t_s_8h"/>
        <childnode refid="66027" relation="include">
        </childnode>
      </node>
      <node id="66040">
        <label>SePtl_TS_To_NS.h</label>
        <link refid="_se_ptl___t_s___to___n_s_8h"/>
        <childnode refid="66027" relation="include">
        </childnode>
      </node>
      <node id="66010">
        <label>unordered_map</label>
      </node>
      <node id="65985">
        <label>TownServer/Src/TownServer.cpp</label>
        <link refid="Src/TownServer.cpp"/>
        <childnode refid="65986" relation="include">
        </childnode>
      </node>
      <node id="66014">
        <label>SeDefine.h</label>
        <link refid="_se_define_8h"/>
      </node>
      <node id="66069">
        <label>SeTCPSvrProc.inl</label>
        <link refid="_src_2_se_t_c_p_svr_proc_8inl"/>
      </node>
      <node id="66037">
        <label>SeCTStream.h</label>
        <link refid="_se_c_t_stream_8h"/>
        <childnode refid="66027" relation="include">
        </childnode>
        <childnode refid="66030" relation="include">
        </childnode>
        <childnode refid="66038" relation="include">
        </childnode>
      </node>
      <node id="66046">
        <label>SeServerTool.h</label>
        <link refid="_se_server_tool_8h"/>
        <childnode refid="65987" relation="include">
        </childnode>
        <childnode refid="66023" relation="include">
        </childnode>
        <childnode refid="66027" relation="include">
        </childnode>
      </node>
      <node id="66033">
        <label>SePtl_MS_To_TS.h</label>
        <link refid="_se_ptl___m_s___to___t_s_8h"/>
        <childnode refid="66027" relation="include">
        </childnode>
      </node>
      <node id="66032">
        <label>SePtl_TS_To_MS.h</label>
        <link refid="_se_ptl___t_s___to___m_s_8h"/>
        <childnode refid="66027" relation="include">
        </childnode>
      </node>
      <node id="66036">
        <label>SePtl_TS_To_WCMS.h</label>
        <link refid="_se_ptl___t_s___to___w_c_m_s_8h"/>
        <childnode refid="66027" relation="include">
        </childnode>
      </node>
      <node id="66066">
        <label>SeWTProcess.inl</label>
        <link refid="_se_w_t_process_8inl"/>
      </node>
      <node id="66011">
        <label>set</label>
      </node>
      <node id="66044">
        <label>SePtl_BLS_To_TS.h</label>
        <link refid="_se_ptl___b_l_s___to___t_s_8h"/>
        <childnode refid="66027" relation="include">
        </childnode>
        <childnode refid="66022" relation="include">
        </childnode>
      </node>
      <node id="66042">
        <label>SePtl_TS_To_BLS.h</label>
        <link refid="_se_ptl___t_s___to___b_l_s_8h"/>
        <childnode refid="66027" relation="include">
        </childnode>
        <childnode refid="66022" relation="include">
        </childnode>
        <childnode refid="66043" relation="include">
        </childnode>
      </node>
      <node id="66068">
        <label>SeMTProcess.inl</label>
        <link refid="_se_m_t_process_8inl"/>
      </node>
      <node id="66072">
        <label>SeTNSend.inl</label>
        <link refid="_se_t_n_send_8inl"/>
      </node>
      <node id="66001">
        <label>algorithm</label>
      </node>
      <node id="66015">
        <label>TownServerDef.h</label>
        <link refid="_src_2_town_server_def_8h"/>
        <childnode refid="66016" relation="include">
        </childnode>
        <childnode refid="66017" relation="include">
        </childnode>
        <childnode refid="66018" relation="include">
        </childnode>
        <childnode refid="66019" relation="include">
        </childnode>
        <childnode refid="66021" relation="include">
        </childnode>
        <childnode refid="66022" relation="include">
        </childnode>
        <childnode refid="66026" relation="include">
        </childnode>
        <childnode refid="66029" relation="include">
        </childnode>
        <childnode refid="66030" relation="include">
        </childnode>
        <childnode refid="66031" relation="include">
        </childnode>
        <childnode refid="66032" relation="include">
        </childnode>
        <childnode refid="66033" relation="include">
        </childnode>
        <childnode refid="66034" relation="include">
        </childnode>
        <childnode refid="66035" relation="include">
        </childnode>
        <childnode refid="66036" relation="include">
        </childnode>
        <childnode refid="66037" relation="include">
        </childnode>
        <childnode refid="66039" relation="include">
        </childnode>
        <childnode refid="66040" relation="include">
        </childnode>
        <childnode refid="66041" relation="include">
        </childnode>
        <childnode refid="66042" relation="include">
        </childnode>
        <childnode refid="66044" relation="include">
        </childnode>
      </node>
      <node id="65998">
        <label>stdio.h</label>
      </node>
      <node id="66064">
        <label>SeTCPSvrSend.inl</label>
        <link refid="_src_2_se_t_c_p_svr_send_8inl"/>
      </node>
      <node id="66057">
        <label>SeRaceRecord.h</label>
        <link refid="_se_race_record_8h"/>
        <childnode refid="65987" relation="include">
        </childnode>
        <childnode refid="66058" relation="include">
        </childnode>
        <childnode refid="66059" relation="include">
        </childnode>
      </node>
      <node id="66059">
        <label>SeCommon.h</label>
        <link refid="_se_common_8h"/>
        <childnode refid="66005" relation="include">
        </childnode>
      </node>
      <node id="66050">
        <label>SePlayer.h</label>
        <link refid="_town_server_2_src_2_se_player_8h"/>
        <childnode refid="66051" relation="include">
        </childnode>
        <childnode refid="66052" relation="include">
        </childnode>
        <childnode refid="66054" relation="include">
        </childnode>
      </node>
    </incdepgraph>
      <sectiondef kind="var">
      <memberdef kind="variable" id="_src_2_town_server_8cpp_1a92b31c0aa05fa0bb3c31db30d81f75fa" prot="public" static="no" mutable="no">
        <type><ref refid="class_town_server" kindref="compound">TownServer</ref></type>
        <definition>TownServer g_kTownServer</definition>
        <argsstring></argsstring>
        <name>g_kTownServer</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="F:/TeamWork/ServerVersion/projects/server/Server/Server/TownServer/Src/TownServer.cpp" line="3" column="1" bodyfile="F:/TeamWork/ServerVersion/projects/server/Server/Server/TownServer/Src/TownServer.cpp" bodystart="3" bodyend="-1"/>
        <referencedby refid="class_se_player_mgr_1a670458b0138dd78dbef5a551a0f595a7" compoundref="_src_2_se_player_mgr_8cpp" startline="54" endline="75">SePlayerMgr::DelPlayer</referencedby>
        <referencedby refid="class_se_player_mgr_1a55a5ce79b27f3610fb6dfac278cc29ac" compoundref="_src_2_se_player_mgr_8cpp" startline="107" endline="122">SePlayerMgr::GetPlayerIP</referencedby>
        <referencedby refid="class_se_player_mgr_1a417e56cf7294ec20129313a70d853d34" compoundref="_src_2_se_player_mgr_8cpp" startline="262" endline="273">SePlayerMgr::OnAddIncmpRace</referencedby>
        <referencedby refid="class_se_race_mgr_1a0eed057d321942fc45980f3251bd05a0" compoundref="_town_server_2_src_2_se_race_mgr_8cpp" startline="48" endline="79">SeRaceMgr::OnCheckGuankaEnd</referencedby>
        <referencedby refid="class_se_player_mgr_1a2fd7547709771867d211da994e832971" compoundref="_src_2_se_player_mgr_8cpp" startline="288" endline="299">SePlayerMgr::OnIncmpRaceKDA</referencedby>
        <referencedby refid="class_se_player_mgr_1ab53f1770be86efd60cccade5e0569ae3" compoundref="_src_2_se_player_mgr_8cpp" startline="179" endline="214">SePlayerMgr::OnLoadPlayerInfoAgain</referencedby>
        <referencedby refid="class_se_player_mgr_1a7a4e410a88efc166d54de65869ce0ac7" compoundref="_src_2_se_player_mgr_8cpp" startline="124" endline="177">SePlayerMgr::OnProcessCommMatchMsg</referencedby>
        <referencedby refid="class_town_server_1adf7f030e2f4c9469911ae930bb9aad3e" compoundref="_src_2_se_town_other_8cpp" startline="166" endline="202">TownServer::OnProcessCommMatchMsg</referencedby>
        <referencedby refid="class_se_player_mgr_1a193876571f2d51eed5b0bc0c254ef249" compoundref="_src_2_se_player_mgr_8cpp" startline="275" endline="286">SePlayerMgr::OnRemoveIncmpRace</referencedby>
        <referencedby refid="class_se_race_mgr_1a3782138266b3b5f98b4a986f3b37e011" compoundref="_town_server_2_src_2_se_race_mgr_8cpp" startline="106" endline="112">SeRaceMgr::OnReqGetIncmpRaceList</referencedby>
        <referencedby refid="class_town_server_1aebfaeb21aa4c92b77abedfae410f822d" compoundref="_src_2_se_m_t_process_8cpp" startline="166" endline="170">TownServer::ProcessMT_GuanqiaEndSend</referencedby>
        <referencedby refid="class_town_server_1abb54fd7932a64de4d034828e47600380" compoundref="_src_2_se_m_t_process_8cpp" startline="160" endline="164">TownServer::ProcessMT_RaceEndSend</referencedby>
        <referencedby refid="class_se_race_mgr_1aa6e5fdc505ba5e569537e747c34ad70f" compoundref="_town_server_2_src_2_se_race_mgr_8cpp" startline="81" endline="104">SeRaceMgr::UpdateSendRaceEndInfo</referencedby>
      </memberdef>
      <memberdef kind="variable" id="_src_2_town_server_8cpp_1ae10136eb68687ac527bdd47164472883" prot="public" static="no" mutable="no">
        <type>std::string</type>
        <definition>std::string g_kVersion</definition>
        <argsstring></argsstring>
        <name>g_kVersion</name>
        <initializer>= <ref refid="_se_tool_8h_1ae4a7dcae8c7ade4db1d6125aa53ab540" kindref="member">GetVersion</ref>(<ref refid="_se_define_8h_1adc43374bec4aa6c4c8af612a8592592d" kindref="member">LOGIC_VERSION</ref>)</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="F:/TeamWork/ServerVersion/projects/server/Server/Server/TownServer/Src/TownServer.cpp" line="4" column="1" bodyfile="F:/TeamWork/ServerVersion/projects/server/Server/Server/TownServer/Src/TownServer.cpp" bodystart="4" bodyend="-1"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="func">
      <memberdef kind="function" id="_src_2_town_server_8cpp_1af2a0c3467676979258b6e1ee17c07af0" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>IMPLEMENT_POOL</definition>
        <argsstring>(SeTCPUser, 256, 256)</argsstring>
        <name>IMPLEMENT_POOL</name>
        <param>
          <type><ref refid="struct_se_t_c_p_user" kindref="compound">SeTCPUser</ref></type>
        </param>
        <param>
          <type>256</type>
        </param>
        <param>
          <type>256</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="F:/TeamWork/ServerVersion/projects/server/Server/Server/TownServer/Src/TownServer.cpp" line="6" column="1"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="preprocessor">#include<sp/>&quot;<ref refid="_src_2_town_server_8h" kindref="compound">TownServer.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="3" refid="src_2_town_server_8h_1a92b31c0aa05fa0bb3c31db30d81f75fa" refkind="member"><highlight class="normal"><ref refid="class_town_server" kindref="compound">TownServer</ref><sp/><sp/><ref refid="_src_2_town_server_8cpp_1a92b31c0aa05fa0bb3c31db30d81f75fa" kindref="member">g_kTownServer</ref>;</highlight></codeline>
<codeline lineno="4" refid="_se_race_record_8cpp_1ae10136eb68687ac527bdd47164472883" refkind="member"><highlight class="normal">std::string<sp/><ref refid="_src_2_town_server_8cpp_1ae10136eb68687ac527bdd47164472883" kindref="member">g_kVersion</ref><sp/>=<sp/><ref refid="_se_tool_8cpp_1ae4a7dcae8c7ade4db1d6125aa53ab540" kindref="member">GetVersion</ref>(<ref refid="_se_define_8h_1adc43374bec4aa6c4c8af612a8592592d" kindref="member">LOGIC_VERSION</ref>);</highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"><ref refid="_src_2_town_server_8cpp_1af2a0c3467676979258b6e1ee17c07af0" kindref="member">IMPLEMENT_POOL</ref>(<ref refid="struct_se_t_c_p_user" kindref="compound">SeTCPUser</ref>,<sp/>256,<sp/>256);</highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight></codeline>
<codeline lineno="8" refid="class_town_server_1aeb01bdc327e70b802ce61a60d53d6d62" refkind="member"><highlight class="normal"><ref refid="class_town_server_1aeb01bdc327e70b802ce61a60d53d6d62" kindref="member">TownServer::TownServer</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="9"><highlight class="normal">{</highlight></codeline>
<codeline lineno="10"><highlight class="normal"><sp/><sp/><sp/><sp/>memset(<ref refid="class_town_server_1ae2c8837aa9c18fcf2c04c892391aa9ad" kindref="member">m_acSend</ref>,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="class_town_server_1ae2c8837aa9c18fcf2c04c892391aa9ad" kindref="member">m_acSend</ref>));</highlight></codeline>
<codeline lineno="11"><highlight class="normal"><sp/><sp/><sp/><sp/>memset(<ref refid="class_town_server_1ad3263ef369285a45786365e9083f2f5e" kindref="member">m_acPraseBuf</ref>,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="class_town_server_1ad3263ef369285a45786365e9083f2f5e" kindref="member">m_acPraseBuf</ref>));</highlight></codeline>
<codeline lineno="12"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a922ed91e15c189a419247a6be0cd5cb2" kindref="member">m_dwTickCount</ref><sp/>=<sp/>GetTickCount();</highlight></codeline>
<codeline lineno="13"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a7d1799846cbc837133f3bdc55608500c" kindref="member">m_dwCurTime</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a0f26adb17692ec28819c07dc5f77f281" kindref="member">m_dwWSRecvSize</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="16"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="_se_tool_8cpp_1ab5215c746438d47cd602ac9cd661d806" kindref="member">NowTime</ref>(<ref refid="class_town_server_1a9dfd67770c631a45baf47062595abf9e" kindref="member">m_kWSTime</ref>);</highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1af64bd4807f0f69adc5a80bd634fd8961" kindref="member">m_iRegisterCount</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a8f1058e4eedcc1b616145d94be97ba70" kindref="member">m_bTCPSvrReady</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a414792e05b13204fcfc3f3c8031e19d3" kindref="member">m_dwReloadPlayerTime</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="23"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1abb7bbc51f8281c31ec714812ff66980b" kindref="member">m_bWSLoadTSReady</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="24"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae6cd29689653d71be5d6aa29ea99f1f6" kindref="member">m_bShowFullCheckInfo</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="25"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ab29acea7ba2a88cff93a2c25eb62a6ea" kindref="member">m_bShowDisconnectLog</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ab344230485c2496c31acd7a4b975646b" kindref="member">m_bWSReady</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ad1eb1384f13fc83a67dd06e4b60ec08d" kindref="member">m_bPrintfFlux</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a58cf489b1129bc3d656b8d4e75078ed0" kindref="member">m_dwPrintfFluxTime</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="30"><highlight class="normal">}</highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight></codeline>
<codeline lineno="32" refid="class_town_server_1a2d50d82f20090cfb214531303f12ae5e" refkind="member"><highlight class="normal"><ref refid="class_town_server_1a2d50d82f20090cfb214531303f12ae5e" kindref="member">TownServer::~TownServer</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="33"><highlight class="normal">{</highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ab7ca6fe0195e023eeaa816b48c6f9a69" kindref="member">Finialize</ref>();</highlight></codeline>
<codeline lineno="35"><highlight class="normal">}</highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight></codeline>
<codeline lineno="37" refid="class_town_server_1a27d439b428c323317bec5900666bc1af" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1a27d439b428c323317bec5900666bc1af" kindref="member">TownServer::LoadConfig</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>pcFile)</highlight></codeline>
<codeline lineno="38"><highlight class="normal">{</highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_se_config" kindref="compound">SeConfig</ref><sp/>kConfig;</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!kConfig.<ref refid="class_se_config_1a077cfce8454c31d293c2d2341980ffca" kindref="member">Load</ref>(pcFile))</highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;Loading<sp/>config<sp/>file<sp/>failed:<sp/>%s&quot;</highlight><highlight class="normal">,pcFile);</highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>pcValue<sp/>=<sp/>kConfig.<ref refid="class_se_config_1a8839d0f5e6b831b66fd018826a304086" kindref="member">GetValue</ref>(</highlight><highlight class="stringliteral">&quot;ServerID&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!pcValue)</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;Loading<sp/>config<sp/>file<sp/>failed:<sp/>%s[ServerID]&quot;</highlight><highlight class="normal">,pcFile);</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a2c873b58dd6321beb01f53c6ebe07bd5" kindref="member">dwServerID</ref><sp/>=<sp/><ref refid="_se_tool_8cpp_1a03bcc77ad4ef4845b20fc5cf4db96834" kindref="member">GetStr2ID</ref>(pcValue);</highlight></codeline>
<codeline lineno="53"><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/>pcValue<sp/>=<sp/>kConfig.<ref refid="class_se_config_1a8839d0f5e6b831b66fd018826a304086" kindref="member">GetValue</ref>(</highlight><highlight class="stringliteral">&quot;TownIndex&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!pcValue)</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;Loading<sp/>setup<sp/>file<sp/>failed:<sp/>%s[TownIndex]&quot;</highlight><highlight class="normal">,pcFile);</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a91fa3b51cf95eb8ef761bd3e9eebb364" kindref="member">iTownIndex</ref><sp/>=<sp/>atoi(pcValue);</highlight></codeline>
<codeline lineno="61"><highlight class="normal"></highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_se_net_addr" kindref="compound">SeNetAddr</ref>*<sp/>pkAddr<sp/>=<sp/>kConfig.<ref refid="class_se_config_1a0bd6ce789230fc24e8e09674c0265d5d" kindref="member">GetNetAddr</ref>(</highlight><highlight class="stringliteral">&quot;AddrToServer&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!pkAddr)</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;Loading<sp/>config<sp/>file<sp/>failed:<sp/>%s[AddrToServer]&quot;</highlight><highlight class="normal">,pcFile);</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a3a90c94642f50b59b33d1791bae22cf2" kindref="member">kAddrToServer</ref><sp/>=<sp/>*pkAddr;</highlight></codeline>
<codeline lineno="69"><highlight class="normal"></highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/>pkAddr<sp/>=<sp/>kConfig.<ref refid="class_se_config_1a0bd6ce789230fc24e8e09674c0265d5d" kindref="member">GetNetAddr</ref>(</highlight><highlight class="stringliteral">&quot;AddrToPlayer&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!pkAddr)</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;Loading<sp/>config<sp/>file<sp/>failed:<sp/>%s[ListenToPlayer]&quot;</highlight><highlight class="normal">,pcFile);</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a8ef2d5a0abf616178be4572477fabf02" kindref="member">kAddrToPlayer</ref><sp/>=<sp/>*pkAddr;</highlight></codeline>
<codeline lineno="77"><highlight class="normal"></highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/>pcValue<sp/>=<sp/>kConfig.<ref refid="class_se_config_1a8839d0f5e6b831b66fd018826a304086" kindref="member">GetValue</ref>(</highlight><highlight class="stringliteral">&quot;DebugLevel&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!pcValue)</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1aef3d1e903f12988e2abe4485171c1e98" kindref="member">iDebugLevel</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1aef3d1e903f12988e2abe4485171c1e98" kindref="member">iDebugLevel</ref><sp/>=<sp/>atoi(pcValue)<sp/>%<sp/><ref refid="_src_2_town_server_def_8h_1ae57426ea3f2293244ab0967d37fd13bea66365ad5880a205629f17d7b2dc64236" kindref="member">MAX_DEBUG_LEVEL</ref>;</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1aef3d1e903f12988e2abe4485171c1e98" kindref="member">iDebugLevel</ref><sp/>&gt;=<sp/>1)</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae6cd29689653d71be5d6aa29ea99f1f6" kindref="member">m_bShowFullCheckInfo</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="91"><highlight class="normal"></highlight></codeline>
<codeline lineno="92"><highlight class="normal"></highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/>pcValue<sp/>=<sp/>kConfig.<ref refid="class_se_config_1a8839d0f5e6b831b66fd018826a304086" kindref="member">GetValue</ref>(</highlight><highlight class="stringliteral">&quot;RaceRecordURLBase&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!pcValue)</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_tool_8cpp_1a4d30fbe56257fc998ebc1346e53be0d8" kindref="member">StrCpy</ref>(<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a59cf15eaa50b3c31f6655bf067777855" kindref="member">acRaceRecordURLBase</ref>,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a59cf15eaa50b3c31f6655bf067777855" kindref="member">acRaceRecordURLBase</ref>),<sp/>pcValue);</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="98"><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"></highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a83f3fe470b91cb8eed8762cc8e5e26c3" kindref="member">SeLogInfo</ref>(</highlight><highlight class="stringliteral">&quot;Loading<sp/>town<sp/>config<sp/>successfully&quot;</highlight><highlight class="normal">,1);</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="102"><highlight class="normal">}</highlight></codeline>
<codeline lineno="103"><highlight class="normal"></highlight></codeline>
<codeline lineno="104" refid="class_town_server_1a8512be7b5ac5d2f505e51709d9281300" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1a8512be7b5ac5d2f505e51709d9281300" kindref="member">TownServer::LoadServerAddr</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>pcFile)</highlight></codeline>
<codeline lineno="105"><highlight class="normal">{</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_se_config" kindref="compound">SeConfig</ref><sp/>kConfig;</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!kConfig.<ref refid="class_se_config_1a077cfce8454c31d293c2d2341980ffca" kindref="member">Load</ref>(pcFile))</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;Loading<sp/>config<sp/>file<sp/>failed:<sp/>%s&quot;</highlight><highlight class="normal">,pcFile);</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="112"><highlight class="normal"></highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_se_net_addr" kindref="compound">SeNetAddr</ref>*<sp/>pkAddr<sp/>=<sp/>kConfig.<ref refid="class_se_config_1a0bd6ce789230fc24e8e09674c0265d5d" kindref="member">GetNetAddr</ref>(</highlight><highlight class="stringliteral">&quot;WorldServer&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!pkAddr)</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;Loading<sp/>config<sp/>file<sp/>failed:<sp/>%s[WorldServer]&quot;</highlight><highlight class="normal">,pcFile);</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a8dd553fd7e8f1e8afd01a6f340701085" kindref="member">kWorldServer</ref>.<ref refid="struct_se_net_addr_1a35c27f89f488d9bd23ee1c19f2ae7b8a" kindref="member">IsEmpty</ref>()<sp/>&amp;&amp;<sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a8dd553fd7e8f1e8afd01a6f340701085" kindref="member">kWorldServer</ref><sp/>!=<sp/>*pkAddr<sp/>&amp;&amp;<sp/>!<ref refid="class_town_server_1a2260fe99dac49c1843f749554b82fd13" kindref="member">m_kWSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>.IsInvalid())</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a83f3fe470b91cb8eed8762cc8e5e26c3" kindref="member">SeLogInfo</ref>(</highlight><highlight class="stringliteral">&quot;WorldServer<sp/>Addr<sp/>Has<sp/>Change<sp/>To[%s:%d]&quot;</highlight><highlight class="normal">,(*pkAddr).acIP,(*pkAddr).iPort);</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ada9f74918ec7e9b670a1f03c8256ee18" kindref="member">m_kNetMgr</ref>.Disconnect(<ref refid="class_town_server_1a2260fe99dac49c1843f749554b82fd13" kindref="member">m_kWSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>);</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="124"><highlight class="normal"></highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a8dd553fd7e8f1e8afd01a6f340701085" kindref="member">kWorldServer</ref><sp/>=<sp/>*pkAddr;</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/>pkAddr<sp/>=<sp/>kConfig.<ref refid="class_se_config_1a0bd6ce789230fc24e8e09674c0265d5d" kindref="member">GetNetAddr</ref>(</highlight><highlight class="stringliteral">&quot;MatchServer&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(pkAddr)</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a2c3294f11d6c9610b60f72b0f0d4035b" kindref="member">kMatchServer</ref>.<ref refid="struct_se_net_addr_1a35c27f89f488d9bd23ee1c19f2ae7b8a" kindref="member">IsEmpty</ref>()<sp/>&amp;&amp;<sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a2c3294f11d6c9610b60f72b0f0d4035b" kindref="member">kMatchServer</ref><sp/>!=<sp/>*pkAddr<sp/>&amp;&amp;<sp/>!<ref refid="class_town_server_1a74126064d555fe0f5d5b74c28dc6100f" kindref="member">m_kMSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>.IsInvalid())</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a83f3fe470b91cb8eed8762cc8e5e26c3" kindref="member">SeLogInfo</ref>(</highlight><highlight class="stringliteral">&quot;MatchServer<sp/>Addr<sp/>Has<sp/>Change<sp/>To[%s:%d]&quot;</highlight><highlight class="normal">,(*pkAddr).acIP,(*pkAddr).iPort);</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ada9f74918ec7e9b670a1f03c8256ee18" kindref="member">m_kNetMgr</ref>.Disconnect(<ref refid="class_town_server_1a74126064d555fe0f5d5b74c28dc6100f" kindref="member">m_kMSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>);</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a2c3294f11d6c9610b60f72b0f0d4035b" kindref="member">kMatchServer</ref><sp/>=<sp/>*pkAddr;</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="136"><highlight class="normal"></highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/>pkAddr<sp/>=<sp/>kConfig.<ref refid="class_se_config_1a0bd6ce789230fc24e8e09674c0265d5d" kindref="member">GetNetAddr</ref>(</highlight><highlight class="stringliteral">&quot;WatchServer&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pkAddr)</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1acdd6db30f204cf680e302bfecdaa3c48" kindref="member">kAddrWCMSServer</ref>.<ref refid="struct_se_net_addr_1a35c27f89f488d9bd23ee1c19f2ae7b8a" kindref="member">IsEmpty</ref>()<sp/>&amp;&amp;<sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1acdd6db30f204cf680e302bfecdaa3c48" kindref="member">kAddrWCMSServer</ref><sp/>!=<sp/>*pkAddr<sp/>&amp;&amp;<sp/>!<ref refid="class_town_server_1ae69fd4b0e77ab87dfd1f68d42597285e" kindref="member">m_kWCSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>.IsInvalid())</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a83f3fe470b91cb8eed8762cc8e5e26c3" kindref="member">SeLogInfo</ref>(</highlight><highlight class="stringliteral">&quot;WatchServer<sp/>Addr<sp/>Has<sp/>Change<sp/>To[%s:%d]&quot;</highlight><highlight class="normal">,<sp/>(*pkAddr).acIP,<sp/>(*pkAddr).iPort);</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ada9f74918ec7e9b670a1f03c8256ee18" kindref="member">m_kNetMgr</ref>.Disconnect(<ref refid="class_town_server_1ae69fd4b0e77ab87dfd1f68d42597285e" kindref="member">m_kWCSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>);</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1acdd6db30f204cf680e302bfecdaa3c48" kindref="member">kAddrWCMSServer</ref><sp/>=<sp/>*pkAddr;</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="147"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/>pkAddr<sp/>=<sp/>kConfig.GetNetAddr(&quot;ContactServer&quot;);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="148"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/>if<sp/>(pkAddr)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="149"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/>{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="150"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(!m_kConfig.kContactServer.IsEmpty()<sp/>&amp;&amp;<sp/>m_kConfig.kContactServer<sp/>!=<sp/>*pkAddr<sp/>&amp;&amp;<sp/>!m_kCSData.kSock.IsInvalid())</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/>{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="152"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SeLogInfo(&quot;ContactServer<sp/>Addr<sp/>Has<sp/>Change<sp/>To[%s:%d]&quot;,<sp/>(*pkAddr).acIP,<sp/>(*pkAddr).iPort);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>m_kNetMgr.Disconnect(m_kCSData.kSock);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="154"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/>}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="155"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/>m_kConfig.kContactServer<sp/>=<sp/>*pkAddr;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="156"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/>}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="157"><highlight class="normal"></highlight></codeline>
<codeline lineno="158"><highlight class="normal"></highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/>pkAddr<sp/>=<sp/>kConfig.<ref refid="class_se_config_1a0bd6ce789230fc24e8e09674c0265d5d" kindref="member">GetNetAddr</ref>(</highlight><highlight class="stringliteral">&quot;NexusServer&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pkAddr)</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1addc45f7eccc05896082f723de9d08562" kindref="member">kNexusServer</ref>.<ref refid="struct_se_net_addr_1a35c27f89f488d9bd23ee1c19f2ae7b8a" kindref="member">IsEmpty</ref>()<sp/>&amp;&amp;<sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1addc45f7eccc05896082f723de9d08562" kindref="member">kNexusServer</ref><sp/>!=<sp/>*pkAddr<sp/>&amp;&amp;<sp/>!<ref refid="class_town_server_1aadc054e4ffc82186b7078c1769c8f014" kindref="member">m_kNSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>.IsInvalid())</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a83f3fe470b91cb8eed8762cc8e5e26c3" kindref="member">SeLogInfo</ref>(</highlight><highlight class="stringliteral">&quot;NexusServer<sp/>Addr<sp/>Has<sp/>Change<sp/>To[%s:%d]&quot;</highlight><highlight class="normal">,<sp/>(*pkAddr).acIP,<sp/>(*pkAddr).iPort);</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ada9f74918ec7e9b670a1f03c8256ee18" kindref="member">m_kNetMgr</ref>.Disconnect(<ref refid="class_town_server_1aadc054e4ffc82186b7078c1769c8f014" kindref="member">m_kNSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>);</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1addc45f7eccc05896082f723de9d08562" kindref="member">kNexusServer</ref><sp/>=<sp/>*pkAddr;</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a83f3fe470b91cb8eed8762cc8e5e26c3" kindref="member">SeLogInfo</ref>(</highlight><highlight class="stringliteral">&quot;Loading<sp/>ServerAddr<sp/>config<sp/>successfully&quot;</highlight><highlight class="normal">,1);</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="171"><highlight class="normal">}</highlight></codeline>
<codeline lineno="172"><highlight class="normal"></highlight></codeline>
<codeline lineno="173" refid="class_town_server_1ab143c0fdf72e69afbe340cdabb4a91e1" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1ab143c0fdf72e69afbe340cdabb4a91e1" kindref="member">TownServer::LoadGameSetup</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>pcFile)</highlight></codeline>
<codeline lineno="174"><highlight class="normal">{</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_se_config" kindref="compound">SeConfig</ref><sp/>kConfig;</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!kConfig.<ref refid="class_se_config_1a077cfce8454c31d293c2d2341980ffca" kindref="member">Load</ref>(pcFile))</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;Loading<sp/>setup<sp/>file<sp/>failed:<sp/>%s&quot;</highlight><highlight class="normal">,pcFile);</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="181"><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>pcValue<sp/>=<sp/>kConfig.<ref refid="class_se_config_1a8839d0f5e6b831b66fd018826a304086" kindref="member">GetValue</ref>(</highlight><highlight class="stringliteral">&quot;SameIpConnect&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!pcValue)</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1aef3d1e903f12988e2abe4485171c1e98" kindref="member">iDebugLevel</ref><sp/>&gt;<sp/>0)</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1aeea3ecc1baf6ea36f15ffecf6081a633" kindref="member">iSameIPConnect</ref><sp/>=<sp/>5000;</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1aeea3ecc1baf6ea36f15ffecf6081a633" kindref="member">iSameIPConnect</ref><sp/>=<sp/>50;</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1aeea3ecc1baf6ea36f15ffecf6081a633" kindref="member">iSameIPConnect</ref><sp/>=<sp/>atoi(pcValue);</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="198"><highlight class="normal"></highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/>pcValue<sp/>=<sp/>kConfig.<ref refid="class_se_config_1a8839d0f5e6b831b66fd018826a304086" kindref="member">GetValue</ref>(</highlight><highlight class="stringliteral">&quot;HeartPackageTime&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pcValue)</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1aafb6b857bae2dd5b541c85fcad87f65d" kindref="member">dwHeartPackageTime</ref><sp/>=<sp/>atoi(pcValue);</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1aafb6b857bae2dd5b541c85fcad87f65d" kindref="member">dwHeartPackageTime</ref><sp/>=<sp/><ref refid="_se_ptl_comm_define_8h_1af62c3a00672953c86a2586d53c60663aa1b823266d1d93b7235977b59560f8c7d" kindref="member">SSD_MAX_HEART_PACKAGE_TIME</ref>;</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="208"><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/>pcValue<sp/>=<sp/>kConfig.<ref refid="class_se_config_1a8839d0f5e6b831b66fd018826a304086" kindref="member">GetValue</ref>(</highlight><highlight class="stringliteral">&quot;PrintfUpdateTime&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(pcValue)</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a6dbafddc9ebf42eeadf68000f4e9d849" kindref="member">dwPrintUpdateTime</ref><sp/>=<sp/>atoi(pcValue);</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a6dbafddc9ebf42eeadf68000f4e9d849" kindref="member">dwPrintUpdateTime</ref><sp/>=<sp/>1000;</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="218"><highlight class="normal"></highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/>pcValue<sp/>=<sp/>kConfig.<ref refid="class_se_config_1a8839d0f5e6b831b66fd018826a304086" kindref="member">GetValue</ref>(</highlight><highlight class="stringliteral">&quot;ShowDisconnectLog&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pcValue)</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a6edeba0a1fbc47a8a4002b62365d0c88" kindref="member">bShowDisconnectLog</ref><sp/>=<sp/>(bool)atoi(pcValue);</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="224"><highlight class="normal"></highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a83f3fe470b91cb8eed8762cc8e5e26c3" kindref="member">SeLogInfo</ref>(</highlight><highlight class="stringliteral">&quot;Loading<sp/>town<sp/>setup<sp/>successfully&quot;</highlight><highlight class="normal">,1);</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="227"><highlight class="normal">}</highlight></codeline>
<codeline lineno="228"><highlight class="normal"></highlight></codeline>
<codeline lineno="229" refid="class_town_server_1af4d9da370cf729a2b5ba87857f988da5" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1af4d9da370cf729a2b5ba87857f988da5" kindref="member">TownServer::ReLoadTownSetup</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="230"><highlight class="normal">{</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="class_town_server_1ab143c0fdf72e69afbe340cdabb4a91e1" kindref="member">LoadGameSetup</ref>(</highlight><highlight class="stringliteral">&quot;./Data/TownSetup.ini&quot;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//return<sp/>SendWS_RefreshInfo();</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="237"><highlight class="normal">}</highlight></codeline>
<codeline lineno="238"><highlight class="normal"></highlight></codeline>
<codeline lineno="239" refid="class_town_server_1a72bf69885d6e5296bb1a630d30b63f6a" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1a72bf69885d6e5296bb1a630d30b63f6a" kindref="member">TownServer::InitializeNet</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="240"><highlight class="normal">{</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!<ref refid="class_town_server_1ada9f74918ec7e9b670a1f03c8256ee18" kindref="member">m_kNetMgr</ref>.Initialize(</highlight><highlight class="keyword">this</highlight><highlight class="normal">,8))</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;Initialize<sp/>net<sp/>failed&quot;</highlight><highlight class="normal">,1);</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a83f3fe470b91cb8eed8762cc8e5e26c3" kindref="member">SeLogInfo</ref>(</highlight><highlight class="stringliteral">&quot;Initialize<sp/>net<sp/>successfully&quot;</highlight><highlight class="normal">,1);</highlight></codeline>
<codeline lineno="247"><highlight class="normal"></highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!<ref refid="class_town_server_1ada9f74918ec7e9b670a1f03c8256ee18" kindref="member">m_kNetMgr</ref>.Listen(<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a3a90c94642f50b59b33d1791bae22cf2" kindref="member">kAddrToServer</ref>.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref>,8,<sp/><ref refid="_se_server_define_8h_1a141dc49d73e6790790a053c29623f606" kindref="member">SERVER_BUFFER_SIZE</ref>))</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;Initialize<sp/>server<sp/>tcp<sp/>port<sp/>failed:[%s:%d]&quot;</highlight><highlight class="normal">,<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a3a90c94642f50b59b33d1791bae22cf2" kindref="member">kAddrToServer</ref>.<ref refid="struct_se_net_addr_1a23b51e87d8b7b2201a03833c9adde232" kindref="member">acIP</ref>,<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a3a90c94642f50b59b33d1791bae22cf2" kindref="member">kAddrToServer</ref>.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref>);</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a83f3fe470b91cb8eed8762cc8e5e26c3" kindref="member">SeLogInfo</ref>(</highlight><highlight class="stringliteral">&quot;Initialize<sp/>server<sp/>tcp<sp/>port<sp/>successfully:[%s:%d]&quot;</highlight><highlight class="normal">,<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a3a90c94642f50b59b33d1791bae22cf2" kindref="member">kAddrToServer</ref>.<ref refid="struct_se_net_addr_1a23b51e87d8b7b2201a03833c9adde232" kindref="member">acIP</ref>,<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a3a90c94642f50b59b33d1791bae22cf2" kindref="member">kAddrToServer</ref>.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref>);</highlight></codeline>
<codeline lineno="254"><highlight class="normal"></highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!<ref refid="class_town_server_1ada9f74918ec7e9b670a1f03c8256ee18" kindref="member">m_kNetMgr</ref>.Listen(<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a8ef2d5a0abf616178be4572477fabf02" kindref="member">kAddrToPlayer</ref>.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref>,128,<sp/><ref refid="_se_server_define_8h_1a141dc49d73e6790790a053c29623f606" kindref="member">SERVER_BUFFER_SIZE</ref>,TSF_16BIT_WIN|TSF_NO_DELAY))</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;Initialize<sp/>player<sp/>tcp<sp/>port<sp/>failed:[%s:%d]&quot;</highlight><highlight class="normal">,<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a8ef2d5a0abf616178be4572477fabf02" kindref="member">kAddrToPlayer</ref>.<ref refid="struct_se_net_addr_1a23b51e87d8b7b2201a03833c9adde232" kindref="member">acIP</ref>,<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a8ef2d5a0abf616178be4572477fabf02" kindref="member">kAddrToPlayer</ref>.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref>);</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="260"><highlight class="normal"></highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a83f3fe470b91cb8eed8762cc8e5e26c3" kindref="member">SeLogInfo</ref>(</highlight><highlight class="stringliteral">&quot;Initialize<sp/>player<sp/>tcp<sp/>port<sp/>successfully:[%s:%d]&quot;</highlight><highlight class="normal">,<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a8ef2d5a0abf616178be4572477fabf02" kindref="member">kAddrToPlayer</ref>.<ref refid="struct_se_net_addr_1a23b51e87d8b7b2201a03833c9adde232" kindref="member">acIP</ref>,<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a8ef2d5a0abf616178be4572477fabf02" kindref="member">kAddrToPlayer</ref>.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref>);</highlight></codeline>
<codeline lineno="262"><highlight class="normal"></highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="264"><highlight class="normal">}</highlight></codeline>
<codeline lineno="265"><highlight class="normal"></highlight></codeline>
<codeline lineno="266" refid="class_town_server_1a1433085214949293f5c0f2dd7c71a176" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1a1433085214949293f5c0f2dd7c71a176" kindref="member">TownServer::Initialize</ref>()</highlight></codeline>
<codeline lineno="267"><highlight class="normal">{</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/>srand(<ref refid="class_town_server_1a922ed91e15c189a419247a6be0cd5cb2" kindref="member">m_dwTickCount</ref>);</highlight></codeline>
<codeline lineno="269"><highlight class="normal"></highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//SetLangType(LOCAL_LANGUAGE);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="272"><highlight class="normal"></highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!<ref refid="class_town_server_1a27d439b428c323317bec5900666bc1af" kindref="member">LoadConfig</ref>(</highlight><highlight class="stringliteral">&quot;./Data/TownServer.ini&quot;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="277"><highlight class="normal"></highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!<ref refid="class_town_server_1a8512be7b5ac5d2f505e51709d9281300" kindref="member">LoadServerAddr</ref>(</highlight><highlight class="stringliteral">&quot;./Data/TownServer.ini&quot;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="282"><highlight class="normal"></highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!<ref refid="class_town_server_1ab143c0fdf72e69afbe340cdabb4a91e1" kindref="member">LoadGameSetup</ref>(</highlight><highlight class="stringliteral">&quot;./Data/TownSetup.ini&quot;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="287"><highlight class="normal"></highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!<ref refid="class_town_server_1a72bf69885d6e5296bb1a630d30b63f6a" kindref="member">InitializeNet</ref>())</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="292"><highlight class="normal"></highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="294"><highlight class="normal">}</highlight></codeline>
<codeline lineno="295"><highlight class="normal"></highlight></codeline>
<codeline lineno="296" refid="class_town_server_1a85c8c9d8962d3bc9f0c7092b2da2157c" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1a85c8c9d8962d3bc9f0c7092b2da2157c" kindref="member">TownServer::ConnectToWS</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="297"><highlight class="normal">{</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!<ref refid="class_town_server_1a2260fe99dac49c1843f749554b82fd13" kindref="member">m_kWSData</ref>.<ref refid="struct_se_server_data_1a53fcdfea60106f5c7179d39b1e259a3e" kindref="member">bConnecting</ref>)</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_se_net_addr" kindref="compound">SeNetAddr</ref>&amp;<sp/>rkWS<sp/>=<sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a8dd553fd7e8f1e8afd01a6f340701085" kindref="member">kWorldServer</ref>;</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<ref refid="class_town_server_1ada9f74918ec7e9b670a1f03c8256ee18" kindref="member">m_kNetMgr</ref>.Connect(rkWS.<ref refid="struct_se_net_addr_1a23b51e87d8b7b2201a03833c9adde232" kindref="member">acIP</ref>,rkWS.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref>,3000,<sp/><ref refid="_se_server_define_8h_1a141dc49d73e6790790a053c29623f606" kindref="member">SERVER_BUFFER_SIZE</ref>))</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a2260fe99dac49c1843f749554b82fd13" kindref="member">m_kWSData</ref>.<ref refid="struct_se_server_data_1a53fcdfea60106f5c7179d39b1e259a3e" kindref="member">bConnecting</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;Connect<sp/>to<sp/>WS<sp/>failed:[%s:%d]&quot;</highlight><highlight class="normal">,<sp/>rkWS.<ref refid="struct_se_net_addr_1a23b51e87d8b7b2201a03833c9adde232" kindref="member">acIP</ref>,<sp/>rkWS.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref>);</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="310"><highlight class="normal">}</highlight></codeline>
<codeline lineno="311"><highlight class="normal"></highlight></codeline>
<codeline lineno="312" refid="class_town_server_1a1f0bb210671fdfa2ffa757b9b367a2e1" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1a1f0bb210671fdfa2ffa757b9b367a2e1" kindref="member">TownServer::RegisterToWS</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="313"><highlight class="normal">{</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>iDTime<sp/>=<sp/>(int)(<ref refid="class_town_server_1a7d1799846cbc837133f3bdc55608500c" kindref="member">m_dwCurTime</ref><sp/>-<sp/><ref refid="class_town_server_1a2260fe99dac49c1843f749554b82fd13" kindref="member">m_kWSData</ref>.<ref refid="struct_se_server_data_1ad83763ea85ed3a8635ca4b9c5a393ba4" kindref="member">dwRegisterTime</ref>);</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<ref refid="class_town_server_1a2260fe99dac49c1843f749554b82fd13" kindref="member">m_kWSData</ref>.<ref refid="struct_se_server_data_1ad83763ea85ed3a8635ca4b9c5a393ba4" kindref="member">dwRegisterTime</ref><sp/>==<sp/>0<sp/>||<sp/>(iDTime<sp/>&gt;<sp/><ref refid="_src_2_d_b_server_def_8h_1acf16ae2ebe7086e6034d6108efca89dbab2431ddb4b2eeafbda48633e06ecf653" kindref="member">RECONNECT_TIME</ref><sp/>||<sp/>iDTime<sp/>&lt;<sp/>0))</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<ref refid="class_town_server_1a2260fe99dac49c1843f749554b82fd13" kindref="member">m_kWSData</ref>.<ref refid="struct_se_server_data_1ad83763ea85ed3a8635ca4b9c5a393ba4" kindref="member">dwRegisterTime</ref>)</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;Register<sp/>to<sp/>WS<sp/>failed&quot;</highlight><highlight class="normal">,1);</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="321"><highlight class="normal"></highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_se_town_info" kindref="compound">SeTownInfo</ref><sp/>kTownInfo;</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>kTownInfo.<ref refid="struct_se_town_info_1aa0af2562e51e083a21bf7def8cde68bf" kindref="member">kAddrToPlayer</ref><sp/>=<sp/><ref refid="class_town_server_1a407b9f18a397c61615638db4637a2e2a" kindref="member">m_kTCPSvrData</ref>.<ref refid="struct_se_t_c_p_svr_data_1a8829c8257b0d2b4a9eb5ed9d71b74ef2" kindref="member">kTCPAddr</ref>;</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//kTownInfo.kAddrToPlayer<sp/>=<sp/>m_kConfig.kAddrToPlayer;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="class_town_server_1ab1314bbc947bd30fedc2f67d66d5deda" kindref="member">SendTW_Register</ref>(<ref refid="_se_ptl_comm_define_8h_1af62c3a00672953c86a2586d53c60663aa051b38374860159471f6a78f1167a7eb" kindref="member">SSD_MSANGO_MAGIC</ref>,<sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a2c873b58dd6321beb01f53c6ebe07bd5" kindref="member">dwServerID</ref>,kTownInfo))</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;Send<sp/>register<sp/>to<sp/>WS<sp/>failed&quot;</highlight><highlight class="normal">,1);</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a83f3fe470b91cb8eed8762cc8e5e26c3" kindref="member">SeLogInfo</ref>(</highlight><highlight class="stringliteral">&quot;Send<sp/>register<sp/>to<sp/>WS<sp/>Success:ip[%s]<sp/>port[%d]&quot;</highlight><highlight class="normal">,<sp/>kTownInfo.<ref refid="struct_se_town_info_1aa0af2562e51e083a21bf7def8cde68bf" kindref="member">kAddrToPlayer</ref>.<ref refid="struct_se_net_addr_1a23b51e87d8b7b2201a03833c9adde232" kindref="member">acIP</ref>,<sp/>kTownInfo.<ref refid="struct_se_town_info_1aa0af2562e51e083a21bf7def8cde68bf" kindref="member">kAddrToPlayer</ref>.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref>);</highlight></codeline>
<codeline lineno="331"><highlight class="normal"></highlight></codeline>
<codeline lineno="332"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/>SeLogInfo(&quot;Send<sp/>register<sp/>to<sp/>WS<sp/>Success:ip[%s]<sp/>port[%d]&quot;,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="333"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>m_kTCPSvrData.kTCPAddr.acIP,<sp/>m_kTCPSvrData.kTCPAddr.iPort);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="334"><highlight class="normal"></highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a2260fe99dac49c1843f749554b82fd13" kindref="member">m_kWSData</ref>.<ref refid="struct_se_server_data_1ad83763ea85ed3a8635ca4b9c5a393ba4" kindref="member">dwRegisterTime</ref><sp/>=<sp/><ref refid="class_town_server_1a7d1799846cbc837133f3bdc55608500c" kindref="member">m_dwCurTime</ref>;</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="337"><highlight class="normal">}</highlight></codeline>
<codeline lineno="338" refid="class_town_server_1a557c4e41f1bb833849f839d5d0f9d88e" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1a557c4e41f1bb833849f839d5d0f9d88e" kindref="member">TownServer::ConnectWCS</ref>()</highlight></codeline>
<codeline lineno="339"><highlight class="normal">{</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="class_town_server_1ae69fd4b0e77ab87dfd1f68d42597285e" kindref="member">m_kWCSData</ref>.<ref refid="struct_se_server_data_1a53fcdfea60106f5c7179d39b1e259a3e" kindref="member">bConnecting</ref>)</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_se_net_addr" kindref="compound">SeNetAddr</ref>&amp;<sp/>rkAddr<sp/>=<sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1acdd6db30f204cf680e302bfecdaa3c48" kindref="member">kAddrWCMSServer</ref>;</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_town_server_1ada9f74918ec7e9b670a1f03c8256ee18" kindref="member">m_kNetMgr</ref>.Connect(rkAddr.<ref refid="struct_se_net_addr_1a23b51e87d8b7b2201a03833c9adde232" kindref="member">acIP</ref>,<sp/>rkAddr.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref>,<sp/>3000,<sp/><ref refid="_se_server_define_8h_1a141dc49d73e6790790a053c29623f606" kindref="member">SERVER_BUFFER_SIZE</ref>))</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae69fd4b0e77ab87dfd1f68d42597285e" kindref="member">m_kWCSData</ref>.<ref refid="struct_se_server_data_1a53fcdfea60106f5c7179d39b1e259a3e" kindref="member">bConnecting</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;Connect<sp/>to<sp/>WCMS<sp/>failed:[%s:%d]&quot;</highlight><highlight class="normal">,<sp/>rkAddr.<ref refid="struct_se_net_addr_1a23b51e87d8b7b2201a03833c9adde232" kindref="member">acIP</ref>,<sp/>rkAddr.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref>);</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="352"><highlight class="normal">}</highlight></codeline>
<codeline lineno="353" refid="class_town_server_1aeb8f1d8c5db400ee140a322ee853dd1e" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1aeb8f1d8c5db400ee140a322ee853dd1e" kindref="member">TownServer::RegisterToWCS</ref>()</highlight></codeline>
<codeline lineno="354"><highlight class="normal">{</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>iDTime<sp/>=<sp/>(int)(<ref refid="class_town_server_1a7d1799846cbc837133f3bdc55608500c" kindref="member">m_dwCurTime</ref><sp/>-<sp/><ref refid="class_town_server_1ae69fd4b0e77ab87dfd1f68d42597285e" kindref="member">m_kWCSData</ref>.<ref refid="struct_se_server_data_1ad83763ea85ed3a8635ca4b9c5a393ba4" kindref="member">dwRegisterTime</ref>);</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_town_server_1ae69fd4b0e77ab87dfd1f68d42597285e" kindref="member">m_kWCSData</ref>.<ref refid="struct_se_server_data_1ad83763ea85ed3a8635ca4b9c5a393ba4" kindref="member">dwRegisterTime</ref><sp/>==<sp/>0<sp/>||<sp/>iDTime<sp/>&gt;<sp/>5<sp/>*<sp/>1000)</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_town_server_1ae69fd4b0e77ab87dfd1f68d42597285e" kindref="member">m_kWCSData</ref>.<ref refid="struct_se_server_data_1ad83763ea85ed3a8635ca4b9c5a393ba4" kindref="member">dwRegisterTime</ref><sp/>!=<sp/>0)</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a83f3fe470b91cb8eed8762cc8e5e26c3" kindref="member">SeLogInfo</ref>(</highlight><highlight class="stringliteral">&quot;Register<sp/>to<sp/>WCMS<sp/>failed&quot;</highlight><highlight class="normal">,<sp/>1);</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="362"><highlight class="normal"></highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="class_town_server_1a7735dc87284ed20f57157244d94f5014" kindref="member">SendTWCMS_Register</ref>(<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a2c873b58dd6321beb01f53c6ebe07bd5" kindref="member">dwServerID</ref>,<sp/>1))</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a83f3fe470b91cb8eed8762cc8e5e26c3" kindref="member">SeLogInfo</ref>(</highlight><highlight class="stringliteral">&quot;Send<sp/>register<sp/>to<sp/>WCMS<sp/>failed&quot;</highlight><highlight class="normal">,<sp/>1);</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae69fd4b0e77ab87dfd1f68d42597285e" kindref="member">m_kWCSData</ref>.<ref refid="struct_se_server_data_1ad83763ea85ed3a8635ca4b9c5a393ba4" kindref="member">dwRegisterTime</ref><sp/>=<sp/><ref refid="class_town_server_1a7d1799846cbc837133f3bdc55608500c" kindref="member">m_dwCurTime</ref>;</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="369"><highlight class="normal">}</highlight></codeline>
<codeline lineno="370"><highlight class="normal"></highlight></codeline>
<codeline lineno="371" refid="class_town_server_1a98f03d03f15948600d4ea78c0a209923" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1a98f03d03f15948600d4ea78c0a209923" kindref="member">TownServer::ConnectToMS</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="372"><highlight class="normal">{</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!<ref refid="class_town_server_1a74126064d555fe0f5d5b74c28dc6100f" kindref="member">m_kMSData</ref>.<ref refid="struct_se_server_data_1a53fcdfea60106f5c7179d39b1e259a3e" kindref="member">bConnecting</ref>)</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_se_net_addr" kindref="compound">SeNetAddr</ref>&amp;<sp/>rkAddr<sp/>=<sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a2c3294f11d6c9610b60f72b0f0d4035b" kindref="member">kMatchServer</ref>;</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<ref refid="class_town_server_1ada9f74918ec7e9b670a1f03c8256ee18" kindref="member">m_kNetMgr</ref>.Connect(rkAddr.<ref refid="struct_se_net_addr_1a23b51e87d8b7b2201a03833c9adde232" kindref="member">acIP</ref>,rkAddr.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref>,3000,<sp/><ref refid="_se_server_define_8h_1a141dc49d73e6790790a053c29623f606" kindref="member">SERVER_BUFFER_SIZE</ref>))</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a74126064d555fe0f5d5b74c28dc6100f" kindref="member">m_kMSData</ref>.<ref refid="struct_se_server_data_1a53fcdfea60106f5c7179d39b1e259a3e" kindref="member">bConnecting</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;Connect<sp/>to<sp/>MS<sp/>failed:[%s:%d]&quot;</highlight><highlight class="normal">,<sp/>rkAddr.<ref refid="struct_se_net_addr_1a23b51e87d8b7b2201a03833c9adde232" kindref="member">acIP</ref>,<sp/>rkAddr.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref>);</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="385"><highlight class="normal">}</highlight></codeline>
<codeline lineno="386"><highlight class="normal"></highlight></codeline>
<codeline lineno="387" refid="class_town_server_1a7d2283214b390f7f4425e6b476b28582" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1a7d2283214b390f7f4425e6b476b28582" kindref="member">TownServer::RegisterToMS</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="388"><highlight class="normal">{</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>iDTime<sp/>=<sp/>(int)(<ref refid="class_town_server_1a7d1799846cbc837133f3bdc55608500c" kindref="member">m_dwCurTime</ref><sp/>-<sp/><ref refid="class_town_server_1a74126064d555fe0f5d5b74c28dc6100f" kindref="member">m_kMSData</ref>.<ref refid="struct_se_server_data_1ad83763ea85ed3a8635ca4b9c5a393ba4" kindref="member">dwRegisterTime</ref>);</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<ref refid="class_town_server_1a74126064d555fe0f5d5b74c28dc6100f" kindref="member">m_kMSData</ref>.<ref refid="struct_se_server_data_1ad83763ea85ed3a8635ca4b9c5a393ba4" kindref="member">dwRegisterTime</ref><sp/>==<sp/>0<sp/>||<sp/>iDTime<sp/>&gt;<sp/>5<sp/>*<sp/>1000)</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<ref refid="class_town_server_1a74126064d555fe0f5d5b74c28dc6100f" kindref="member">m_kMSData</ref>.<ref refid="struct_se_server_data_1ad83763ea85ed3a8635ca4b9c5a393ba4" kindref="member">dwRegisterTime</ref><sp/>!=<sp/>0)</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a83f3fe470b91cb8eed8762cc8e5e26c3" kindref="member">SeLogInfo</ref>(</highlight><highlight class="stringliteral">&quot;Register<sp/>to<sp/>MS<sp/>failed&quot;</highlight><highlight class="normal">,1);</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="396"><highlight class="normal"></highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="class_town_server_1a4c53d900309252e5d6e6d65bbf4274a3" kindref="member">SendTM_Register</ref>(<ref refid="_se_ptl_comm_define_8h_1af62c3a00672953c86a2586d53c60663aa051b38374860159471f6a78f1167a7eb" kindref="member">SSD_MSANGO_MAGIC</ref>,<sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a2c873b58dd6321beb01f53c6ebe07bd5" kindref="member">dwServerID</ref>,<sp/>1,<sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a91fa3b51cf95eb8ef761bd3e9eebb364" kindref="member">iTownIndex</ref>,</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0,<sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1aff1f25d0a2e1e81e1f77872d231b9eec" kindref="member">iMaxNormalPlayerNum</ref>,<sp/><ref refid="class_town_server_1af64bd4807f0f69adc5a80bd634fd8961" kindref="member">m_iRegisterCount</ref>++))</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a83f3fe470b91cb8eed8762cc8e5e26c3" kindref="member">SeLogInfo</ref>(</highlight><highlight class="stringliteral">&quot;Send<sp/>register<sp/>to<sp/>MS<sp/>failed&quot;</highlight><highlight class="normal">,1);</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a74126064d555fe0f5d5b74c28dc6100f" kindref="member">m_kMSData</ref>.<ref refid="struct_se_server_data_1ad83763ea85ed3a8635ca4b9c5a393ba4" kindref="member">dwRegisterTime</ref><sp/>=<sp/><ref refid="class_town_server_1a7d1799846cbc837133f3bdc55608500c" kindref="member">m_dwCurTime</ref>;</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="404"><highlight class="normal">}</highlight></codeline>
<codeline lineno="405"><highlight class="normal"></highlight></codeline>
<codeline lineno="406" refid="class_town_server_1a083cc57e4d094453e0a30af54f57b3a6" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1a083cc57e4d094453e0a30af54f57b3a6" kindref="member">TownServer::ConnectToNS</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="407"><highlight class="normal">{</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="class_town_server_1aadc054e4ffc82186b7078c1769c8f014" kindref="member">m_kNSData</ref>.<ref refid="struct_se_server_data_1a53fcdfea60106f5c7179d39b1e259a3e" kindref="member">bConnecting</ref>)</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_se_net_addr" kindref="compound">SeNetAddr</ref>&amp;<sp/>rkAddr<sp/>=<sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1addc45f7eccc05896082f723de9d08562" kindref="member">kNexusServer</ref>;</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_town_server_1ada9f74918ec7e9b670a1f03c8256ee18" kindref="member">m_kNetMgr</ref>.Connect(rkAddr.<ref refid="struct_se_net_addr_1a23b51e87d8b7b2201a03833c9adde232" kindref="member">acIP</ref>,<sp/>rkAddr.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref>,<sp/>3000,<sp/><ref refid="_se_server_define_8h_1a141dc49d73e6790790a053c29623f606" kindref="member">SERVER_BUFFER_SIZE</ref>))</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1aadc054e4ffc82186b7078c1769c8f014" kindref="member">m_kNSData</ref>.<ref refid="struct_se_server_data_1a53fcdfea60106f5c7179d39b1e259a3e" kindref="member">bConnecting</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;Connect<sp/>to<sp/>NS<sp/>failed:[%s:%d]&quot;</highlight><highlight class="normal">,<sp/>rkAddr.<ref refid="struct_se_net_addr_1a23b51e87d8b7b2201a03833c9adde232" kindref="member">acIP</ref>,<sp/>rkAddr.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref>);</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="420"><highlight class="normal">}</highlight></codeline>
<codeline lineno="421"><highlight class="normal"></highlight></codeline>
<codeline lineno="422" refid="class_town_server_1a12b23673ecb7569506573d25e38e0fba" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1a12b23673ecb7569506573d25e38e0fba" kindref="member">TownServer::RegisterToNS</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="423"><highlight class="normal">{</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>iDTime<sp/>=<sp/>(int)(<ref refid="class_town_server_1a7d1799846cbc837133f3bdc55608500c" kindref="member">m_dwCurTime</ref><sp/>-<sp/><ref refid="class_town_server_1aadc054e4ffc82186b7078c1769c8f014" kindref="member">m_kNSData</ref>.<ref refid="struct_se_server_data_1ad83763ea85ed3a8635ca4b9c5a393ba4" kindref="member">dwRegisterTime</ref>);</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_town_server_1aadc054e4ffc82186b7078c1769c8f014" kindref="member">m_kNSData</ref>.<ref refid="struct_se_server_data_1ad83763ea85ed3a8635ca4b9c5a393ba4" kindref="member">dwRegisterTime</ref><sp/>==<sp/>0<sp/>||<sp/>iDTime<sp/>&gt;<sp/>5<sp/>*<sp/>1000)</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_town_server_1aadc054e4ffc82186b7078c1769c8f014" kindref="member">m_kNSData</ref>.<ref refid="struct_se_server_data_1ad83763ea85ed3a8635ca4b9c5a393ba4" kindref="member">dwRegisterTime</ref><sp/>!=<sp/>0)</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a83f3fe470b91cb8eed8762cc8e5e26c3" kindref="member">SeLogInfo</ref>(</highlight><highlight class="stringliteral">&quot;Register<sp/>to<sp/>NS<sp/>failed&quot;</highlight><highlight class="normal">,<sp/>1);</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="431"><highlight class="normal"></highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="class_town_server_1a7edd0319ea65a1cd7b74a77369b7ebac" kindref="member">SendTN_Register</ref>(<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a2c873b58dd6321beb01f53c6ebe07bd5" kindref="member">dwServerID</ref>,<sp/>1))</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a83f3fe470b91cb8eed8762cc8e5e26c3" kindref="member">SeLogInfo</ref>(</highlight><highlight class="stringliteral">&quot;Send<sp/>register<sp/>to<sp/>NS<sp/>failed&quot;</highlight><highlight class="normal">,<sp/>1);</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1aadc054e4ffc82186b7078c1769c8f014" kindref="member">m_kNSData</ref>.<ref refid="struct_se_server_data_1ad83763ea85ed3a8635ca4b9c5a393ba4" kindref="member">dwRegisterTime</ref><sp/>=<sp/><ref refid="class_town_server_1a7d1799846cbc837133f3bdc55608500c" kindref="member">m_dwCurTime</ref>;</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="438"><highlight class="normal">}</highlight></codeline>
<codeline lineno="439"><highlight class="normal"></highlight></codeline>
<codeline lineno="440" refid="class_town_server_1a75e7569d13cb337066e41508c51a983d" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1a75e7569d13cb337066e41508c51a983d" kindref="member">TownServer::UpdateState</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="441"><highlight class="normal">{</highlight></codeline>
<codeline lineno="442"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/>if<sp/>(!m_bTCPSvrReady)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="443"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/>{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="444"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/>return;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="445"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/>}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="446"><highlight class="normal"></highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="class_town_server_1a2260fe99dac49c1843f749554b82fd13" kindref="member">m_kWSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>.IsInvalid()<sp/>&amp;&amp;<sp/>!<ref refid="class_town_server_1a2260fe99dac49c1843f749554b82fd13" kindref="member">m_kWSData</ref>.<ref refid="struct_se_server_data_1a4d91e2d15b4bc404ebc4ec42254ac770" kindref="member">bRegistered</ref><sp/>&amp;&amp;<sp/><ref refid="class_town_server_1a407b9f18a397c61615638db4637a2e2a" kindref="member">m_kTCPSvrData</ref>.<ref refid="struct_se_t_c_p_svr_data_1a1b70825dbb35ebab73d146abeb1898cd" kindref="member">bRegister</ref>)</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a1f0bb210671fdfa2ffa757b9b367a2e1" kindref="member">RegisterToWS</ref>();</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="452"><highlight class="normal"></highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>DWord<sp/>s_dwPreTime<sp/>=<sp/>g_kTownServer.<ref refid="class_town_server_1a4af3de3dae06fe186e2e24b3f58210eb" kindref="member">GetServerTime</ref>();</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(s_dwPreTime<sp/>==<sp/>g_kTownServer.<ref refid="class_town_server_1a4af3de3dae06fe186e2e24b3f58210eb" kindref="member">GetServerTime</ref>()<sp/>||<sp/>(int)(g_kTownServer.<ref refid="class_town_server_1a4af3de3dae06fe186e2e24b3f58210eb" kindref="member">GetServerTime</ref>()<sp/>-<sp/>s_dwPreTime)<sp/>&gt;<sp/>5000<sp/>||<sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)(g_kTownServer.<ref refid="class_town_server_1a4af3de3dae06fe186e2e24b3f58210eb" kindref="member">GetServerTime</ref>()<sp/>-<sp/>s_dwPreTime)<sp/>&lt;<sp/>0)</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>s_dwPreTime<sp/>=<sp/>g_kTownServer.<ref refid="class_town_server_1a4af3de3dae06fe186e2e24b3f58210eb" kindref="member">GetServerTime</ref>();</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<ref refid="class_town_server_1a2260fe99dac49c1843f749554b82fd13" kindref="member">m_kWSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>.IsInvalid())</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>test_code</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a85c8c9d8962d3bc9f0c7092b2da2157c" kindref="member">ConnectToWS</ref>();</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="463"><highlight class="normal"></highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>test_code</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//if(m_kConfig.kMatchServer.iPort<sp/>!=<sp/>0<sp/>&amp;&amp;<sp/>m_kWSData.bRegistered<sp/>&amp;&amp;<sp/>IsWSReady())</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a2c3294f11d6c9610b60f72b0f0d4035b" kindref="member">kMatchServer</ref>.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref><sp/>!=<sp/>0)</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<ref refid="class_town_server_1a74126064d555fe0f5d5b74c28dc6100f" kindref="member">m_kMSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>.IsInvalid())</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a98f03d03f15948600d4ea78c0a209923" kindref="member">ConnectToMS</ref>();</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!<ref refid="class_town_server_1a74126064d555fe0f5d5b74c28dc6100f" kindref="member">m_kMSData</ref>.<ref refid="struct_se_server_data_1a4d91e2d15b4bc404ebc4ec42254ac770" kindref="member">bRegistered</ref>)</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a7d2283214b390f7f4425e6b476b28582" kindref="member">RegisterToMS</ref>();</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="477"><highlight class="normal"></highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1acdd6db30f204cf680e302bfecdaa3c48" kindref="member">kAddrWCMSServer</ref>.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref><sp/>!=<sp/>0)</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_town_server_1ae69fd4b0e77ab87dfd1f68d42597285e" kindref="member">m_kWCSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>.IsInvalid())</highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a557c4e41f1bb833849f839d5d0f9d88e" kindref="member">ConnectWCS</ref>();</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="class_town_server_1ae69fd4b0e77ab87dfd1f68d42597285e" kindref="member">m_kWCSData</ref>.<ref refid="struct_se_server_data_1a4d91e2d15b4bc404ebc4ec42254ac770" kindref="member">bRegistered</ref>)</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1aeb8f1d8c5db400ee140a322ee853dd1e" kindref="member">RegisterToWCS</ref>();</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="489"><highlight class="normal"></highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1addc45f7eccc05896082f723de9d08562" kindref="member">kNexusServer</ref>.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref><sp/>!=<sp/>0)</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_town_server_1aadc054e4ffc82186b7078c1769c8f014" kindref="member">m_kNSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>.IsInvalid())</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a083cc57e4d094453e0a30af54f57b3a6" kindref="member">ConnectToNS</ref>();</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="class_town_server_1aadc054e4ffc82186b7078c1769c8f014" kindref="member">m_kNSData</ref>.<ref refid="struct_se_server_data_1a4d91e2d15b4bc404ebc4ec42254ac770" kindref="member">bRegistered</ref>)</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a12b23673ecb7569506573d25e38e0fba" kindref="member">RegisterToNS</ref>();</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="501"><highlight class="normal">}</highlight></codeline>
<codeline lineno="502"><highlight class="normal"></highlight></codeline>
<codeline lineno="503" refid="class_town_server_1aae8d335ec43f3db322c6a8370a8d974f" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1aae8d335ec43f3db322c6a8370a8d974f" kindref="member">TownServer::Update</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="504"><highlight class="normal">{</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//m_kRandNum.RandInt();</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="506"><highlight class="normal"></highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/>DWord<sp/>dwTickCount<sp/>=<sp/>GetTickCount();</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>iDTime<sp/>=<sp/>(int)(dwTickCount<sp/>-<sp/><ref refid="class_town_server_1a922ed91e15c189a419247a6be0cd5cb2" kindref="member">m_dwTickCount</ref>);</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a922ed91e15c189a419247a6be0cd5cb2" kindref="member">m_dwTickCount</ref><sp/>=<sp/>dwTickCount;</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a7d1799846cbc837133f3bdc55608500c" kindref="member">m_dwCurTime</ref><sp/>+=<sp/>iDTime;</highlight></codeline>
<codeline lineno="511"><highlight class="normal"></highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/>DWord<sp/>adwDecTime[32];</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/>memset(adwDecTime,0,</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(adwDecTime));</highlight></codeline>
<codeline lineno="514"><highlight class="normal"></highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!<ref refid="class_town_server_1ad1eb1384f13fc83a67dd06e4b60ec08d" kindref="member">m_bPrintfFlux</ref>)</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memset(&amp;<ref refid="class_town_server_1adc29e2715a0d0d329cbbc9f5f2293118" kindref="member">m_kFlux</ref>,0,</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="class_town_server_1adc29e2715a0d0d329cbbc9f5f2293118" kindref="member">m_kFlux</ref>));</highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="519"><highlight class="normal"></highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/>DWord<sp/>dwBeginTime<sp/>=<sp/>GetTickCount();</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ada9f74918ec7e9b670a1f03c8256ee18" kindref="member">m_kNetMgr</ref>.Update();</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/>adwDecTime[0]<sp/>=<sp/>GetTickCount()<sp/>-<sp/>dwBeginTime;</highlight></codeline>
<codeline lineno="523"><highlight class="normal"></highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/>dwBeginTime<sp/>=<sp/>GetTickCount();</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a75e7569d13cb337066e41508c51a983d" kindref="member">UpdateState</ref>();</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/>adwDecTime[1]<sp/>=<sp/>GetTickCount()<sp/>-<sp/>dwBeginTime;</highlight></codeline>
<codeline lineno="527"><highlight class="normal"></highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/>dwBeginTime<sp/>=<sp/>GetTickCount();</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="_src_2_se_player_mgr_8cpp_1abc19838f74a7bdf07c113aab87f5b364" kindref="member">g_kPlayerMgr</ref>.<ref refid="class_se_player_mgr_1a17b0aa87dab898913ec745e1086ecb93" kindref="member">Update</ref>();</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/>adwDecTime[5]<sp/>=<sp/>GetTickCount()<sp/>-<sp/>dwBeginTime;</highlight></codeline>
<codeline lineno="531"><highlight class="normal"></highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a250b1791d6cf2ebeefddfdc0f6b597f1" kindref="member">UpdateHeartPackage</ref>();</highlight></codeline>
<codeline lineno="533"><highlight class="normal"></highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//UpdatePrintfNetState();</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="536"><highlight class="normal"></highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(GetTickCount()<sp/>-<sp/>dwTickCount<sp/>&gt;<sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a6dbafddc9ebf42eeadf68000f4e9d849" kindref="member">dwPrintUpdateTime</ref>)</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;Update<sp/>overtime!&quot;</highlight><highlight class="normal">,1);</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//PrintUpdateTime(adwDecTime,32);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="541"><highlight class="normal"></highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//OnPrintfNetState();</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="545"><highlight class="normal">}</highlight></codeline>
<codeline lineno="546"><highlight class="normal"></highlight></codeline>
<codeline lineno="547" refid="class_town_server_1ab7ca6fe0195e023eeaa816b48c6f9a69" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1ab7ca6fe0195e023eeaa816b48c6f9a69" kindref="member">TownServer::Finialize</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="548"><highlight class="normal">{</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ada9f74918ec7e9b670a1f03c8256ee18" kindref="member">m_kNetMgr</ref>.Finialize();</highlight></codeline>
<codeline lineno="550"><highlight class="normal"></highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="_src_2_se_player_mgr_8cpp_1abc19838f74a7bdf07c113aab87f5b364" kindref="member">g_kPlayerMgr</ref>.<ref refid="class_se_player_mgr_1a1e298631e0597b748faf9e6daf1e5dcc" kindref="member">Finialize</ref>();</highlight></codeline>
<codeline lineno="552"><highlight class="normal">}</highlight></codeline>
<codeline lineno="553"><highlight class="normal"></highlight></codeline>
<codeline lineno="554" refid="class_town_server_1a640664779b0da8cfaf7316a4f2bb647f" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1a640664779b0da8cfaf7316a4f2bb647f" kindref="member">TownServer::ShowConsoleTitle</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>iDTime)</highlight></codeline>
<codeline lineno="555"><highlight class="normal">{</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>acString[512];</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="_se_server_tool_8cpp_1ad2735ec90511f0d6ec1535cf448709b8" kindref="member">SPrintf</ref>(acString,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(acString),<sp/></highlight><highlight class="stringliteral">&quot;TS[%s]<sp/>DT[%d]<sp/>PL:[%d/%d]<sp/>WSRev:%uM&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_tool_8h_1ada81d4ae5d39c42af0a02b45f4a6f715" kindref="member">GetID2Str</ref>(<ref refid="class_town_server_1a5e3760e69ce56efddfa697d5fc52716d" kindref="member">GetServerID</ref>()),<sp/>iDTime,</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_src_2_se_player_mgr_8cpp_1abc19838f74a7bdf07c113aab87f5b364" kindref="member">g_kPlayerMgr</ref>.<ref refid="class_se_player_mgr_1a2901743afdd620565361394343c47466" kindref="member">GetTotalPlayerNum</ref>(),</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a27b89d97519ca47223492d72aeceb135" kindref="member">GetTcpUserNum</ref>(),</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>g_kTownServer.<ref refid="class_town_server_1aba45027490f6538d0f62c61db16069ee" kindref="member">GetWSRecvSize</ref>()<sp/>/<sp/>1024<sp/>/<sp/>1024);</highlight></codeline>
<codeline lineno="562"><highlight class="normal"></highlight></codeline>
<codeline lineno="563"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_WIN32</highlight></codeline>
<codeline lineno="564"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/>SetConsoleTitle(acString);</highlight></codeline>
<codeline lineno="565"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="566"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//SeLogInfo(&quot;%s&quot;,<sp/>acString);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="567"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="568"><highlight class="preprocessor"></highlight><highlight class="normal">}</highlight></codeline>
<codeline lineno="569"><highlight class="normal"></highlight></codeline>
<codeline lineno="570" refid="class_town_server_1a209044eb8f407aebc86f676d5b979654" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1a209044eb8f407aebc86f676d5b979654" kindref="member">TownServer::OnNetConnected</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>HSock&amp;<sp/>rkSock,</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>pcIP,</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>iPort)</highlight></codeline>
<codeline lineno="571"><highlight class="normal">{</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!strcmp(pcIP,<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a8dd553fd7e8f1e8afd01a6f340701085" kindref="member">kWorldServer</ref>.<ref refid="struct_se_net_addr_1a23b51e87d8b7b2201a03833c9adde232" kindref="member">acIP</ref>)<sp/>&amp;&amp;<sp/>iPort<sp/>==<sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a8dd553fd7e8f1e8afd01a6f340701085" kindref="member">kWorldServer</ref>.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref>)</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a2260fe99dac49c1843f749554b82fd13" kindref="member">m_kWSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref><sp/>=<sp/>rkSock;</highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a2260fe99dac49c1843f749554b82fd13" kindref="member">m_kWSData</ref>.<ref refid="struct_se_server_data_1a53fcdfea60106f5c7179d39b1e259a3e" kindref="member">bConnecting</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="576"><highlight class="normal"></highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!rkSock.IsInvalid())</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a83f3fe470b91cb8eed8762cc8e5e26c3" kindref="member">SeLogInfo</ref>(</highlight><highlight class="stringliteral">&quot;Connect<sp/>to<sp/>WS<sp/>successfully:[%s:%d]&quot;</highlight><highlight class="normal">,<sp/>pcIP,<sp/>iPort);</highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;Connect<sp/>to<sp/>WS<sp/>failed:[%s:%d]&quot;</highlight><highlight class="normal">,<sp/>pcIP,<sp/>iPort);</highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!strcmp(pcIP,<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a2c3294f11d6c9610b60f72b0f0d4035b" kindref="member">kMatchServer</ref>.<ref refid="struct_se_net_addr_1a23b51e87d8b7b2201a03833c9adde232" kindref="member">acIP</ref>)<sp/>&amp;&amp;<sp/>iPort<sp/>==<sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a2c3294f11d6c9610b60f72b0f0d4035b" kindref="member">kMatchServer</ref>.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref>)</highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a74126064d555fe0f5d5b74c28dc6100f" kindref="member">m_kMSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref><sp/>=<sp/>rkSock;</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a74126064d555fe0f5d5b74c28dc6100f" kindref="member">m_kMSData</ref>.<ref refid="struct_se_server_data_1a53fcdfea60106f5c7179d39b1e259a3e" kindref="member">bConnecting</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="590"><highlight class="normal"></highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!rkSock.IsInvalid())</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a83f3fe470b91cb8eed8762cc8e5e26c3" kindref="member">SeLogInfo</ref>(</highlight><highlight class="stringliteral">&quot;Connect<sp/>to<sp/>MS<sp/>successfully:[%s:%d]&quot;</highlight><highlight class="normal">,pcIP,iPort);</highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;Connect<sp/>to<sp/>MS<sp/>failed:[%s:%d]&quot;</highlight><highlight class="normal">,pcIP,iPort);</highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(pcIP,<sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1acdd6db30f204cf680e302bfecdaa3c48" kindref="member">kAddrWCMSServer</ref>.<ref refid="struct_se_net_addr_1a23b51e87d8b7b2201a03833c9adde232" kindref="member">acIP</ref>)<sp/>&amp;&amp;<sp/>iPort<sp/>==<sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1acdd6db30f204cf680e302bfecdaa3c48" kindref="member">kAddrWCMSServer</ref>.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref>)</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae69fd4b0e77ab87dfd1f68d42597285e" kindref="member">m_kWCSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref><sp/>=<sp/>rkSock;</highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae69fd4b0e77ab87dfd1f68d42597285e" kindref="member">m_kWCSData</ref>.<ref refid="struct_se_server_data_1a53fcdfea60106f5c7179d39b1e259a3e" kindref="member">bConnecting</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="604"><highlight class="normal"></highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!rkSock.IsInvalid())</highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a83f3fe470b91cb8eed8762cc8e5e26c3" kindref="member">SeLogInfo</ref>(</highlight><highlight class="stringliteral">&quot;Connect<sp/>to<sp/>WCMS<sp/>successfully:[%s:%d]&quot;</highlight><highlight class="normal">,<sp/>pcIP,<sp/>iPort);</highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;Connect<sp/>to<sp/>WCMS<sp/>failed:[%s:%d]&quot;</highlight><highlight class="normal">,<sp/>pcIP,<sp/>iPort);</highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(pcIP,<sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1addc45f7eccc05896082f723de9d08562" kindref="member">kNexusServer</ref>.<ref refid="struct_se_net_addr_1a23b51e87d8b7b2201a03833c9adde232" kindref="member">acIP</ref>)<sp/>&amp;&amp;<sp/>iPort<sp/>==<sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1addc45f7eccc05896082f723de9d08562" kindref="member">kNexusServer</ref>.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref>)</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1aadc054e4ffc82186b7078c1769c8f014" kindref="member">m_kNSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref><sp/>=<sp/>rkSock;</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1aadc054e4ffc82186b7078c1769c8f014" kindref="member">m_kNSData</ref>.<ref refid="struct_se_server_data_1a53fcdfea60106f5c7179d39b1e259a3e" kindref="member">bConnecting</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="618"><highlight class="normal"></highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!rkSock.IsInvalid())</highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a83f3fe470b91cb8eed8762cc8e5e26c3" kindref="member">SeLogInfo</ref>(</highlight><highlight class="stringliteral">&quot;Connect<sp/>to<sp/>NS<sp/>successfully:[%s:%d]&quot;</highlight><highlight class="normal">,<sp/>pcIP,<sp/>iPort);</highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;Connect<sp/>to<sp/>NS<sp/>failed:[%s:%d]&quot;</highlight><highlight class="normal">,<sp/>pcIP,<sp/>iPort);</highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="628"><highlight class="normal">}</highlight></codeline>
<codeline lineno="629"><highlight class="normal"></highlight></codeline>
<codeline lineno="630" refid="class_town_server_1a6a326b70e23b67a8a43f26967d15aed1" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1a6a326b70e23b67a8a43f26967d15aed1" kindref="member">TownServer::OnNetAccept</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>HSock&amp;<sp/>rkSock,</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>iListenPort,</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>pcIP,</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>iPort)</highlight></codeline>
<codeline lineno="631"><highlight class="normal">{</highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(iListenPort<sp/>==<sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a8ef2d5a0abf616178be4572477fabf02" kindref="member">kAddrToPlayer</ref>.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref>)</highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="class_town_server_1a407b9f18a397c61615638db4637a2e2a" kindref="member">m_kTCPSvrData</ref>.<ref refid="struct_se_t_c_p_svr_data_1a68aa05eb38ccf42ac144185e31b0fa9d" kindref="member">kSock</ref>.IsInvalid())</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ada9f74918ec7e9b670a1f03c8256ee18" kindref="member">m_kNetMgr</ref>.Disconnect(<ref refid="class_town_server_1a407b9f18a397c61615638db4637a2e2a" kindref="member">m_kTCPSvrData</ref>.<ref refid="struct_se_t_c_p_svr_data_1a68aa05eb38ccf42ac144185e31b0fa9d" kindref="member">kSock</ref>);</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;AnOther<sp/>Tcp<sp/>Connect--&gt;Tcp<sp/>disconnect:[%s:%d]&quot;</highlight><highlight class="normal">,<sp/><ref refid="class_town_server_1a407b9f18a397c61615638db4637a2e2a" kindref="member">m_kTCPSvrData</ref>.<ref refid="struct_se_t_c_p_svr_data_1a1eaa0b72458d7f6d495220fc97ea6179" kindref="member">kNetAddr</ref>.<ref refid="struct_se_net_addr_1a23b51e87d8b7b2201a03833c9adde232" kindref="member">acIP</ref>,<sp/><ref refid="class_town_server_1a407b9f18a397c61615638db4637a2e2a" kindref="member">m_kTCPSvrData</ref>.<ref refid="struct_se_t_c_p_svr_data_1a1eaa0b72458d7f6d495220fc97ea6179" kindref="member">kNetAddr</ref>.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref>);</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="639"><highlight class="normal"></highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a407b9f18a397c61615638db4637a2e2a" kindref="member">m_kTCPSvrData</ref>.<ref refid="struct_se_t_c_p_svr_data_1a68aa05eb38ccf42ac144185e31b0fa9d" kindref="member">kSock</ref><sp/>=<sp/>rkSock;</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a407b9f18a397c61615638db4637a2e2a" kindref="member">m_kTCPSvrData</ref>.<ref refid="struct_se_t_c_p_svr_data_1a1b70825dbb35ebab73d146abeb1898cd" kindref="member">bRegister</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a407b9f18a397c61615638db4637a2e2a" kindref="member">m_kTCPSvrData</ref>.<ref refid="struct_se_t_c_p_svr_data_1a19954b9b010b926965e3be511342e4fb" kindref="member">dwConnectTime</ref><sp/>=<sp/><ref refid="class_town_server_1a7d1799846cbc837133f3bdc55608500c" kindref="member">m_dwCurTime</ref>;</highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>strcpy(<ref refid="class_town_server_1a407b9f18a397c61615638db4637a2e2a" kindref="member">m_kTCPSvrData</ref>.<ref refid="struct_se_t_c_p_svr_data_1a1eaa0b72458d7f6d495220fc97ea6179" kindref="member">kNetAddr</ref>.<ref refid="struct_se_net_addr_1a23b51e87d8b7b2201a03833c9adde232" kindref="member">acIP</ref>,<sp/>pcIP);</highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a407b9f18a397c61615638db4637a2e2a" kindref="member">m_kTCPSvrData</ref>.<ref refid="struct_se_t_c_p_svr_data_1a1eaa0b72458d7f6d495220fc97ea6179" kindref="member">kNetAddr</ref>.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref><sp/>=<sp/>iPort;</highlight></codeline>
<codeline lineno="645"><highlight class="normal"></highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a83f3fe470b91cb8eed8762cc8e5e26c3" kindref="member">SeLogInfo</ref>(<sp/></highlight><highlight class="stringliteral">&quot;TCPSvr<sp/>connect:[%s:%d]&quot;</highlight><highlight class="normal">,<sp/>pcIP,<sp/>iPort);</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="648"><highlight class="normal">}</highlight></codeline>
<codeline lineno="649"><highlight class="normal"></highlight></codeline>
<codeline lineno="650" refid="class_town_server_1a9f6712108ed5271e55e52255ad88b3ca" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1a9f6712108ed5271e55e52255ad88b3ca" kindref="member">TownServer::OnNetRecv</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>HSock&amp;<sp/>rkSock,</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>pkData,</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>iSize)</highlight></codeline>
<codeline lineno="651"><highlight class="normal">{</highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(iSize<sp/>&lt;<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="struct_se_c_m_d" kindref="compound">SeCMD</ref>))</highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ada9f74918ec7e9b670a1f03c8256ee18" kindref="member">m_kNetMgr</ref>.Disconnect(rkSock);</highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="657"><highlight class="normal"></highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(rkSock<sp/>==<sp/><ref refid="class_town_server_1a2260fe99dac49c1843f749554b82fd13" kindref="member">m_kWSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>)</highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a0f26adb17692ec28819c07dc5f77f281" kindref="member">m_dwWSRecvSize</ref><sp/>+=<sp/>iSize;</highlight></codeline>
<codeline lineno="661"><highlight class="normal"></highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_se_c_m_d" kindref="compound">SeCMD</ref>*<sp/>pkCmd<sp/>=<sp/>(<ref refid="struct_se_c_m_d" kindref="compound">SeCMD</ref>*)pkData;</highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pkCmd-&gt;<ref refid="struct_se_c_m_d_1a2efa122a60040d09cfca777f9155394c" kindref="member">wCmd</ref><sp/>&gt;=<sp/><ref refid="_se_server_define_8h_1a5ef39269c62c879ff0b5584312980bc2a127d784a8a86960e57070125cc360c9f" kindref="member">STCB_BLS_TS</ref><sp/>&amp;&amp;<sp/>pkCmd-&gt;<ref refid="struct_se_c_m_d_1a2efa122a60040d09cfca777f9155394c" kindref="member">wCmd</ref><sp/>&lt;<sp/><ref refid="_se_server_define_8h_1a5ef39269c62c879ff0b5584312980bc2a127d784a8a86960e57070125cc360c9f" kindref="member">STCB_BLS_TS</ref><sp/>+<sp/><ref refid="_se_server_define_8h_1a7e57d75ea3d17743d491908f4fb5cc93" kindref="member">STCB_INTERVAL</ref>)</highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a8185d93b1cf3c314a90d7f1a7574497c" kindref="member">ProcessBLTData</ref>(pkData,<sp/>iSize);</highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="668"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a7e7d55e1fae4fd47b8872b136a18563e" kindref="member">ProcessWTData</ref>(pkData,<sp/>iSize);</highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(rkSock<sp/>==<sp/><ref refid="class_town_server_1a74126064d555fe0f5d5b74c28dc6100f" kindref="member">m_kMSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>)</highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a38f8315323fa3cd4cbd9c2ec05333381" kindref="member">ProcessMTData</ref>(pkData,<sp/>iSize);</highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rkSock<sp/>==<sp/><ref refid="class_town_server_1ae69fd4b0e77ab87dfd1f68d42597285e" kindref="member">m_kWCSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>)</highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="680"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1aaa202d58561028277e1e344c85bba1c3" kindref="member">ProcessWCMSTData</ref>(pkData,<sp/>iSize);</highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_town_server_1a407b9f18a397c61615638db4637a2e2a" kindref="member">m_kTCPSvrData</ref>.<ref refid="struct_se_t_c_p_svr_data_1a68aa05eb38ccf42ac144185e31b0fa9d" kindref="member">kSock</ref><sp/>==<sp/>rkSock)</highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ac6392943ff8b3ebe5c7a5f5df2ee2840" kindref="member">ProcessTCPSvr</ref>(pkData,<sp/>iSize);</highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="688"><highlight class="normal"></highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rkSock<sp/>==<sp/><ref refid="class_town_server_1aadc054e4ffc82186b7078c1769c8f014" kindref="member">m_kNSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>)</highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a4a1028b0c9d92904253ddbff0eb16093" kindref="member">ProcessNTData</ref>(pkData,<sp/>iSize);</highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="694"><highlight class="normal"></highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ada9f74918ec7e9b670a1f03c8256ee18" kindref="member">m_kNetMgr</ref>.Disconnect(rkSock);</highlight></codeline>
<codeline lineno="696"><highlight class="normal">}</highlight></codeline>
<codeline lineno="697"><highlight class="normal"></highlight></codeline>
<codeline lineno="698" refid="class_town_server_1ada71b982d42bc643c908d565be70f4df" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1ada71b982d42bc643c908d565be70f4df" kindref="member">TownServer::OnNetDisconnect</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>HSock&amp;<sp/>rkSock,TeDisconnectCode<sp/>eCode,</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>iParam)</highlight></codeline>
<codeline lineno="699"><highlight class="normal">{</highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(rkSock<sp/>==<sp/><ref refid="class_town_server_1a2260fe99dac49c1843f749554b82fd13" kindref="member">m_kWSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>)</highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a2260fe99dac49c1843f749554b82fd13" kindref="member">m_kWSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a2260fe99dac49c1843f749554b82fd13" kindref="member">m_kWSData</ref>.<ref refid="struct_se_server_data_1a53fcdfea60106f5c7179d39b1e259a3e" kindref="member">bConnecting</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a2260fe99dac49c1843f749554b82fd13" kindref="member">m_kWSData</ref>.<ref refid="struct_se_server_data_1ad83763ea85ed3a8635ca4b9c5a393ba4" kindref="member">dwRegisterTime</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a2260fe99dac49c1843f749554b82fd13" kindref="member">m_kWSData</ref>.<ref refid="struct_se_server_data_1a4d91e2d15b4bc404ebc4ec42254ac770" kindref="member">bRegistered</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a3cbbea0c52a65fd3e2da54c08969df79" kindref="member">SetWSReady</ref>(</highlight><highlight class="keyword">false</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="707"><highlight class="normal"></highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;Disconnect<sp/>from<sp/>WS:[%s:%d]<sp/>DisconnectCode[%d]<sp/>Param[%d]&quot;</highlight><highlight class="normal">,<sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a8dd553fd7e8f1e8afd01a6f340701085" kindref="member">kWorldServer</ref>.<ref refid="struct_se_net_addr_1a23b51e87d8b7b2201a03833c9adde232" kindref="member">acIP</ref>,<sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a8dd553fd7e8f1e8afd01a6f340701085" kindref="member">kWorldServer</ref>.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref>,<sp/>eCode,<sp/>iParam);</highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(rkSock<sp/>==<sp/><ref refid="class_town_server_1a74126064d555fe0f5d5b74c28dc6100f" kindref="member">m_kMSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>)</highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a74126064d555fe0f5d5b74c28dc6100f" kindref="member">m_kMSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a74126064d555fe0f5d5b74c28dc6100f" kindref="member">m_kMSData</ref>.<ref refid="struct_se_server_data_1a53fcdfea60106f5c7179d39b1e259a3e" kindref="member">bConnecting</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a74126064d555fe0f5d5b74c28dc6100f" kindref="member">m_kMSData</ref>.<ref refid="struct_se_server_data_1ad83763ea85ed3a8635ca4b9c5a393ba4" kindref="member">dwRegisterTime</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a74126064d555fe0f5d5b74c28dc6100f" kindref="member">m_kMSData</ref>.<ref refid="struct_se_server_data_1a4d91e2d15b4bc404ebc4ec42254ac770" kindref="member">bRegistered</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="717"><highlight class="normal"></highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;Disconnect<sp/>from<sp/>MS:[%s:%d]<sp/>Code[%d]<sp/>Para[%d]&quot;</highlight><highlight class="normal">,<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a2c3294f11d6c9610b60f72b0f0d4035b" kindref="member">kMatchServer</ref>.<ref refid="struct_se_net_addr_1a23b51e87d8b7b2201a03833c9adde232" kindref="member">acIP</ref>,<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1a2c3294f11d6c9610b60f72b0f0d4035b" kindref="member">kMatchServer</ref>.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref>,eCode,iParam);</highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rkSock<sp/>==<sp/><ref refid="class_town_server_1ae69fd4b0e77ab87dfd1f68d42597285e" kindref="member">m_kWCSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>)</highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae69fd4b0e77ab87dfd1f68d42597285e" kindref="member">m_kWCSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae69fd4b0e77ab87dfd1f68d42597285e" kindref="member">m_kWCSData</ref>.<ref refid="struct_se_server_data_1a53fcdfea60106f5c7179d39b1e259a3e" kindref="member">bConnecting</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae69fd4b0e77ab87dfd1f68d42597285e" kindref="member">m_kWCSData</ref>.<ref refid="struct_se_server_data_1ad83763ea85ed3a8635ca4b9c5a393ba4" kindref="member">dwRegisterTime</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae69fd4b0e77ab87dfd1f68d42597285e" kindref="member">m_kWCSData</ref>.<ref refid="struct_se_server_data_1a4d91e2d15b4bc404ebc4ec42254ac770" kindref="member">bRegistered</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="727"><highlight class="normal"></highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;Disconnect<sp/>from<sp/>WCMS:[%s:%d]<sp/>Code[%d]<sp/>Para[%d]&quot;</highlight><highlight class="normal">,<sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1acdd6db30f204cf680e302bfecdaa3c48" kindref="member">kAddrWCMSServer</ref>.<ref refid="struct_se_net_addr_1a23b51e87d8b7b2201a03833c9adde232" kindref="member">acIP</ref>,<sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1acdd6db30f204cf680e302bfecdaa3c48" kindref="member">kAddrWCMSServer</ref>.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref>,<sp/>eCode,<sp/>iParam);</highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rkSock<sp/>==<sp/><ref refid="class_town_server_1a407b9f18a397c61615638db4637a2e2a" kindref="member">m_kTCPSvrData</ref>.<ref refid="struct_se_t_c_p_svr_data_1a68aa05eb38ccf42ac144185e31b0fa9d" kindref="member">kSock</ref>)</highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a407b9f18a397c61615638db4637a2e2a" kindref="member">m_kTCPSvrData</ref>.<ref refid="struct_se_t_c_p_svr_data_1a68aa05eb38ccf42ac144185e31b0fa9d" kindref="member">kSock</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a407b9f18a397c61615638db4637a2e2a" kindref="member">m_kTCPSvrData</ref>.<ref refid="struct_se_t_c_p_svr_data_1a1b70825dbb35ebab73d146abeb1898cd" kindref="member">bRegister</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a8f1058e4eedcc1b616145d94be97ba70" kindref="member">m_bTCPSvrReady</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;TCPSvr<sp/>disconnect:[%s:%d]<sp/>Code[%d]<sp/>Param[%d]&quot;</highlight><highlight class="normal">,<sp/><ref refid="class_town_server_1a407b9f18a397c61615638db4637a2e2a" kindref="member">m_kTCPSvrData</ref>.<ref refid="struct_se_t_c_p_svr_data_1a1eaa0b72458d7f6d495220fc97ea6179" kindref="member">kNetAddr</ref>.<ref refid="struct_se_net_addr_1a23b51e87d8b7b2201a03833c9adde232" kindref="member">acIP</ref>,<sp/><ref refid="class_town_server_1a407b9f18a397c61615638db4637a2e2a" kindref="member">m_kTCPSvrData</ref>.<ref refid="struct_se_t_c_p_svr_data_1a1eaa0b72458d7f6d495220fc97ea6179" kindref="member">kNetAddr</ref>.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref>,<sp/>eCode,<sp/>iParam);</highlight></codeline>
<codeline lineno="737"><highlight class="normal"></highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae118205b2eef262be0237d186aa1d4a0" kindref="member">OnTCPSvrDisconnect</ref>();</highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rkSock<sp/>==<sp/><ref refid="class_town_server_1aadc054e4ffc82186b7078c1769c8f014" kindref="member">m_kNSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>)</highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1aadc054e4ffc82186b7078c1769c8f014" kindref="member">m_kNSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1aadc054e4ffc82186b7078c1769c8f014" kindref="member">m_kNSData</ref>.<ref refid="struct_se_server_data_1a53fcdfea60106f5c7179d39b1e259a3e" kindref="member">bConnecting</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1aadc054e4ffc82186b7078c1769c8f014" kindref="member">m_kNSData</ref>.<ref refid="struct_se_server_data_1ad83763ea85ed3a8635ca4b9c5a393ba4" kindref="member">dwRegisterTime</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1aadc054e4ffc82186b7078c1769c8f014" kindref="member">m_kNSData</ref>.<ref refid="struct_se_server_data_1a4d91e2d15b4bc404ebc4ec42254ac770" kindref="member">bRegistered</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="746"><highlight class="normal"></highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;Disconnect<sp/>from<sp/>NS:[%s:%d]<sp/>Code[%d]<sp/>Para[%d]&quot;</highlight><highlight class="normal">,<sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1addc45f7eccc05896082f723de9d08562" kindref="member">kNexusServer</ref>.<ref refid="struct_se_net_addr_1a23b51e87d8b7b2201a03833c9adde232" kindref="member">acIP</ref>,<sp/><ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1addc45f7eccc05896082f723de9d08562" kindref="member">kNexusServer</ref>.<ref refid="struct_se_net_addr_1a989fa5b025bc039122e8d2a29838fde9" kindref="member">iPort</ref>,<sp/>eCode,<sp/>iParam);</highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="750"><highlight class="normal">}</highlight></codeline>
<codeline lineno="751"><highlight class="normal"></highlight></codeline>
<codeline lineno="752" refid="class_town_server_1a250b1791d6cf2ebeefddfdc0f6b597f1" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1a250b1791d6cf2ebeefddfdc0f6b597f1" kindref="member">TownServer::UpdateHeartPackage</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="753"><highlight class="normal">{</highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<ref refid="class_town_server_1a4af3de3dae06fe186e2e24b3f58210eb" kindref="member">GetServerTime</ref>()<sp/>&lt;<sp/>10<sp/>*<sp/>1000)</highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="758"><highlight class="normal"></highlight></codeline>
<codeline lineno="759"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>DWord<sp/>s_dwPreTime<sp/>=<sp/><ref refid="class_town_server_1a4af3de3dae06fe186e2e24b3f58210eb" kindref="member">GetServerTime</ref>();</highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>iDecTime<sp/>=<sp/>(int)(<ref refid="class_town_server_1a4af3de3dae06fe186e2e24b3f58210eb" kindref="member">GetServerTime</ref>()<sp/>-<sp/>s_dwPreTime);</highlight></codeline>
<codeline lineno="761"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(iDecTime<sp/>&lt;<sp/>1000)</highlight></codeline>
<codeline lineno="762"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="763"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="765"><highlight class="normal"></highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/><sp/><sp/>s_dwPreTime<sp/>=<sp/><ref refid="class_town_server_1a4af3de3dae06fe186e2e24b3f58210eb" kindref="member">GetServerTime</ref>();</highlight></codeline>
<codeline lineno="767"><highlight class="normal"></highlight></codeline>
<codeline lineno="768"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ad1f0f92f45ea891b5e3ffa8a1547ea69" kindref="member">UpdateWSHeartPackage</ref>();</highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1aa9f784b5307dd7a7217e41161623c53d" kindref="member">UpdateMSHeartPackage</ref>();</highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1aca82fc69069f8d6f052ea294578fd1d0" kindref="member">UpdateWCSHeartPackage</ref>();</highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a8e668559f285d53fe5ce637e60ebedb0" kindref="member">UpdateNSHeartPackage</ref>();</highlight></codeline>
<codeline lineno="772"><highlight class="normal">}</highlight></codeline>
<codeline lineno="773"><highlight class="normal"></highlight></codeline>
<codeline lineno="774" refid="class_town_server_1ad1f0f92f45ea891b5e3ffa8a1547ea69" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1ad1f0f92f45ea891b5e3ffa8a1547ea69" kindref="member">TownServer::UpdateWSHeartPackage</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="775"><highlight class="normal">{</highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<ref refid="class_town_server_1a2260fe99dac49c1843f749554b82fd13" kindref="member">m_kWSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>.IsInvalid())</highlight></codeline>
<codeline lineno="777"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a2260fe99dac49c1843f749554b82fd13" kindref="member">m_kWSData</ref>.<ref refid="struct_se_server_data_1a6c75241d7cd68409f25f383feb838ca3" kindref="member">dwHeartPackageTime</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="781"><highlight class="normal"></highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<ref refid="class_town_server_1a2260fe99dac49c1843f749554b82fd13" kindref="member">m_kWSData</ref>.<ref refid="struct_se_server_data_1a6c75241d7cd68409f25f383feb838ca3" kindref="member">dwHeartPackageTime</ref><sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="784"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="class_town_server_1abb55c66a617ef5068d19050e40af3cd9" kindref="member">SendTW_HeartPackage</ref>())</highlight></codeline>
<codeline lineno="785"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="786"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;SendWS<sp/>HeartPackage<sp/>Error&quot;</highlight><highlight class="normal">,1);</highlight></codeline>
<codeline lineno="787"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="788"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="789"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="790"><highlight class="normal"></highlight></codeline>
<codeline lineno="791"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>iDecTime<sp/>=<sp/>(int)(<ref refid="class_town_server_1a4af3de3dae06fe186e2e24b3f58210eb" kindref="member">GetServerTime</ref>()<sp/>-<sp/><ref refid="class_town_server_1a2260fe99dac49c1843f749554b82fd13" kindref="member">m_kWSData</ref>.<ref refid="struct_se_server_data_1a6c75241d7cd68409f25f383feb838ca3" kindref="member">dwHeartPackageTime</ref>);</highlight></codeline>
<codeline lineno="792"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(iDecTime<sp/>&gt;=<sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1aafb6b857bae2dd5b541c85fcad87f65d" kindref="member">dwHeartPackageTime</ref>)</highlight></codeline>
<codeline lineno="793"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="794"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1acaae2b1fac3d7c5e54147ad2e8f907ee" kindref="member">DisconnectWS</ref>();</highlight></codeline>
<codeline lineno="795"><highlight class="normal"></highlight></codeline>
<codeline lineno="796"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;HeartPackageTime<sp/>OverTime<sp/>DisconnectWS<sp/>[%d]<sp/>&quot;</highlight><highlight class="normal">,<sp/>iDecTime);</highlight></codeline>
<codeline lineno="797"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a2260fe99dac49c1843f749554b82fd13" kindref="member">m_kWSData</ref>.<ref refid="struct_se_server_data_1a6c75241d7cd68409f25f383feb838ca3" kindref="member">dwHeartPackageTime</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="798"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="799"><highlight class="normal">}</highlight></codeline>
<codeline lineno="800"><highlight class="normal"></highlight></codeline>
<codeline lineno="801" refid="class_town_server_1aca82fc69069f8d6f052ea294578fd1d0" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1aca82fc69069f8d6f052ea294578fd1d0" kindref="member">TownServer::UpdateWCSHeartPackage</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="802"><highlight class="normal">{</highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_town_server_1ae69fd4b0e77ab87dfd1f68d42597285e" kindref="member">m_kWCSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>.IsInvalid())</highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="805"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae69fd4b0e77ab87dfd1f68d42597285e" kindref="member">m_kWCSData</ref>.<ref refid="struct_se_server_data_1a6c75241d7cd68409f25f383feb838ca3" kindref="member">dwHeartPackageTime</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="806"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="807"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="808"><highlight class="normal"></highlight></codeline>
<codeline lineno="809"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_town_server_1ae69fd4b0e77ab87dfd1f68d42597285e" kindref="member">m_kWCSData</ref>.<ref refid="struct_se_server_data_1a6c75241d7cd68409f25f383feb838ca3" kindref="member">dwHeartPackageTime</ref><sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_town_server_1ae69fd4b0e77ab87dfd1f68d42597285e" kindref="member">m_kWCSData</ref>.<ref refid="struct_se_server_data_1a4d91e2d15b4bc404ebc4ec42254ac770" kindref="member">bRegistered</ref>)</highlight></codeline>
<codeline lineno="812"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="813"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_town_server_1ac34b8d9c4dd8d039ac7f06c061a3e3ea" kindref="member">SendTWCMS_HeartPackage</ref>())</highlight></codeline>
<codeline lineno="814"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae69fd4b0e77ab87dfd1f68d42597285e" kindref="member">m_kWCSData</ref>.<ref refid="struct_se_server_data_1a6c75241d7cd68409f25f383feb838ca3" kindref="member">dwHeartPackageTime</ref><sp/>=<sp/><ref refid="class_town_server_1a4af3de3dae06fe186e2e24b3f58210eb" kindref="member">GetServerTime</ref>();</highlight></codeline>
<codeline lineno="816"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="818"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="819"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;SendTWCMS_HeartPackage<sp/>Failed&quot;</highlight><highlight class="normal">,<sp/>1);</highlight></codeline>
<codeline lineno="820"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="821"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="822"><highlight class="normal"></highlight></codeline>
<codeline lineno="823"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="824"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="825"><highlight class="normal"></highlight></codeline>
<codeline lineno="826"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>iDecTime<sp/>=<sp/>(int)(<ref refid="class_town_server_1a4af3de3dae06fe186e2e24b3f58210eb" kindref="member">GetServerTime</ref>()<sp/>-<sp/><ref refid="class_town_server_1ae69fd4b0e77ab87dfd1f68d42597285e" kindref="member">m_kWCSData</ref>.<ref refid="struct_se_server_data_1a6c75241d7cd68409f25f383feb838ca3" kindref="member">dwHeartPackageTime</ref>);</highlight></codeline>
<codeline lineno="827"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(iDecTime<sp/>&gt;=<sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1aafb6b857bae2dd5b541c85fcad87f65d" kindref="member">dwHeartPackageTime</ref>)</highlight></codeline>
<codeline lineno="828"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="829"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ada9f74918ec7e9b670a1f03c8256ee18" kindref="member">m_kNetMgr</ref>.Disconnect(<ref refid="class_town_server_1ae69fd4b0e77ab87dfd1f68d42597285e" kindref="member">m_kWCSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>);</highlight></codeline>
<codeline lineno="830"><highlight class="normal"></highlight></codeline>
<codeline lineno="831"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;HeartPackageTime<sp/>OverTime<sp/>DisconnectWCMS<sp/>[%d]<sp/>&quot;</highlight><highlight class="normal">,<sp/>iDecTime);</highlight></codeline>
<codeline lineno="832"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ae69fd4b0e77ab87dfd1f68d42597285e" kindref="member">m_kWCSData</ref>.<ref refid="struct_se_server_data_1a6c75241d7cd68409f25f383feb838ca3" kindref="member">dwHeartPackageTime</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="833"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="834"><highlight class="normal">}</highlight></codeline>
<codeline lineno="835"><highlight class="normal"></highlight></codeline>
<codeline lineno="836" refid="class_town_server_1aa9f784b5307dd7a7217e41161623c53d" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1aa9f784b5307dd7a7217e41161623c53d" kindref="member">TownServer::UpdateMSHeartPackage</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="837"><highlight class="normal">{</highlight></codeline>
<codeline lineno="838"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_town_server_1a74126064d555fe0f5d5b74c28dc6100f" kindref="member">m_kMSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>.IsInvalid())</highlight></codeline>
<codeline lineno="839"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="840"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a74126064d555fe0f5d5b74c28dc6100f" kindref="member">m_kMSData</ref>.<ref refid="struct_se_server_data_1a6c75241d7cd68409f25f383feb838ca3" kindref="member">dwHeartPackageTime</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="841"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="842"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="843"><highlight class="normal"></highlight></codeline>
<codeline lineno="844"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_town_server_1a74126064d555fe0f5d5b74c28dc6100f" kindref="member">m_kMSData</ref>.<ref refid="struct_se_server_data_1a6c75241d7cd68409f25f383feb838ca3" kindref="member">dwHeartPackageTime</ref><sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="845"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="846"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_town_server_1a74126064d555fe0f5d5b74c28dc6100f" kindref="member">m_kMSData</ref>.<ref refid="struct_se_server_data_1a4d91e2d15b4bc404ebc4ec42254ac770" kindref="member">bRegistered</ref>)</highlight></codeline>
<codeline lineno="847"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="848"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_town_server_1a4bd8af4b0b65083c70db07d59ab224de" kindref="member">SendTM_HeartPackage</ref>(<ref refid="class_town_server_1a27b89d97519ca47223492d72aeceb135" kindref="member">GetTcpUserNum</ref>(),<sp/>0))</highlight></codeline>
<codeline lineno="849"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="850"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a74126064d555fe0f5d5b74c28dc6100f" kindref="member">m_kMSData</ref>.<ref refid="struct_se_server_data_1a6c75241d7cd68409f25f383feb838ca3" kindref="member">dwHeartPackageTime</ref><sp/>=<sp/><ref refid="class_town_server_1a4af3de3dae06fe186e2e24b3f58210eb" kindref="member">GetServerTime</ref>();</highlight></codeline>
<codeline lineno="851"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="852"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="853"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="854"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;SendMS_HeartPackage<sp/>Failed&quot;</highlight><highlight class="normal">,1);</highlight></codeline>
<codeline lineno="855"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="856"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="857"><highlight class="normal"></highlight></codeline>
<codeline lineno="858"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="859"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="860"><highlight class="normal"></highlight></codeline>
<codeline lineno="861"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>iDecTime<sp/>=<sp/>(int)(<ref refid="class_town_server_1a4af3de3dae06fe186e2e24b3f58210eb" kindref="member">GetServerTime</ref>()<sp/>-<sp/><ref refid="class_town_server_1a74126064d555fe0f5d5b74c28dc6100f" kindref="member">m_kMSData</ref>.<ref refid="struct_se_server_data_1a6c75241d7cd68409f25f383feb838ca3" kindref="member">dwHeartPackageTime</ref>);</highlight></codeline>
<codeline lineno="862"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(iDecTime<sp/>&gt;=<sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1aafb6b857bae2dd5b541c85fcad87f65d" kindref="member">dwHeartPackageTime</ref>)</highlight></codeline>
<codeline lineno="863"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="864"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ada9f74918ec7e9b670a1f03c8256ee18" kindref="member">m_kNetMgr</ref>.Disconnect(<ref refid="class_town_server_1a74126064d555fe0f5d5b74c28dc6100f" kindref="member">m_kMSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>);</highlight></codeline>
<codeline lineno="865"><highlight class="normal"></highlight></codeline>
<codeline lineno="866"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;HeartPackageTime<sp/>OverTime<sp/>DisconnectMS<sp/>[%d]<sp/>&quot;</highlight><highlight class="normal">,<sp/>iDecTime);</highlight></codeline>
<codeline lineno="867"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1a74126064d555fe0f5d5b74c28dc6100f" kindref="member">m_kMSData</ref>.<ref refid="struct_se_server_data_1a6c75241d7cd68409f25f383feb838ca3" kindref="member">dwHeartPackageTime</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="868"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="869"><highlight class="normal">}</highlight></codeline>
<codeline lineno="870"><highlight class="normal"></highlight></codeline>
<codeline lineno="871" refid="class_town_server_1a8e668559f285d53fe5ce637e60ebedb0" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1a8e668559f285d53fe5ce637e60ebedb0" kindref="member">TownServer::UpdateNSHeartPackage</ref>()</highlight></codeline>
<codeline lineno="872"><highlight class="normal">{</highlight></codeline>
<codeline lineno="873"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_town_server_1aadc054e4ffc82186b7078c1769c8f014" kindref="member">m_kNSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>.IsInvalid())</highlight></codeline>
<codeline lineno="874"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="875"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1aadc054e4ffc82186b7078c1769c8f014" kindref="member">m_kNSData</ref>.<ref refid="struct_se_server_data_1a6c75241d7cd68409f25f383feb838ca3" kindref="member">dwHeartPackageTime</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="876"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="877"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="878"><highlight class="normal"></highlight></codeline>
<codeline lineno="879"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_town_server_1aadc054e4ffc82186b7078c1769c8f014" kindref="member">m_kNSData</ref>.<ref refid="struct_se_server_data_1a6c75241d7cd68409f25f383feb838ca3" kindref="member">dwHeartPackageTime</ref><sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="880"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="881"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_town_server_1aadc054e4ffc82186b7078c1769c8f014" kindref="member">m_kNSData</ref>.<ref refid="struct_se_server_data_1a4d91e2d15b4bc404ebc4ec42254ac770" kindref="member">bRegistered</ref>)</highlight></codeline>
<codeline lineno="882"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="883"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_town_server_1a44f2eda12e0e790733c3d79d8d1b8d4a" kindref="member">SendTN_HeartPackage</ref>())</highlight></codeline>
<codeline lineno="884"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="885"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1aadc054e4ffc82186b7078c1769c8f014" kindref="member">m_kNSData</ref>.<ref refid="struct_se_server_data_1a6c75241d7cd68409f25f383feb838ca3" kindref="member">dwHeartPackageTime</ref><sp/>=<sp/><ref refid="class_town_server_1a4af3de3dae06fe186e2e24b3f58210eb" kindref="member">GetServerTime</ref>();</highlight></codeline>
<codeline lineno="886"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="887"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="888"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="889"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;SendTN_HeartPackage<sp/>Failed&quot;</highlight><highlight class="normal">,<sp/>1);</highlight></codeline>
<codeline lineno="890"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="891"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="892"><highlight class="normal"></highlight></codeline>
<codeline lineno="893"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="894"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="895"><highlight class="normal"></highlight></codeline>
<codeline lineno="896"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>iDecTime<sp/>=<sp/>(int)(<ref refid="class_town_server_1a4af3de3dae06fe186e2e24b3f58210eb" kindref="member">GetServerTime</ref>()<sp/>-<sp/><ref refid="class_town_server_1aadc054e4ffc82186b7078c1769c8f014" kindref="member">m_kNSData</ref>.<ref refid="struct_se_server_data_1a6c75241d7cd68409f25f383feb838ca3" kindref="member">dwHeartPackageTime</ref>);</highlight></codeline>
<codeline lineno="897"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(iDecTime<sp/>&gt;=<sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)<ref refid="class_town_server_1ae06c9b74cc25aca9f96f0648378101db" kindref="member">m_kConfig</ref>.<ref refid="struct_se_town_config_1aafb6b857bae2dd5b541c85fcad87f65d" kindref="member">dwHeartPackageTime</ref>)</highlight></codeline>
<codeline lineno="898"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="899"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ada9f74918ec7e9b670a1f03c8256ee18" kindref="member">m_kNetMgr</ref>.Disconnect(<ref refid="class_town_server_1aadc054e4ffc82186b7078c1769c8f014" kindref="member">m_kNSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>);</highlight></codeline>
<codeline lineno="900"><highlight class="normal"></highlight></codeline>
<codeline lineno="901"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;HeartPackageTime<sp/>OverTime<sp/>DisconnectNS<sp/>[%d]<sp/>&quot;</highlight><highlight class="normal">,<sp/>iDecTime);</highlight></codeline>
<codeline lineno="902"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1aadc054e4ffc82186b7078c1769c8f014" kindref="member">m_kNSData</ref>.<ref refid="struct_se_server_data_1a6c75241d7cd68409f25f383feb838ca3" kindref="member">dwHeartPackageTime</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="903"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="904"><highlight class="normal">}</highlight></codeline>
<codeline lineno="905"><highlight class="normal"></highlight></codeline>
<codeline lineno="906" refid="class_town_server_1ae118205b2eef262be0237d186aa1d4a0" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_town_server_1ae118205b2eef262be0237d186aa1d4a0" kindref="member">TownServer::OnTCPSvrDisconnect</ref>()</highlight></codeline>
<codeline lineno="907"><highlight class="normal">{</highlight></codeline>
<codeline lineno="908"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ada9f74918ec7e9b670a1f03c8256ee18" kindref="member">m_kNetMgr</ref>.Disconnect(<ref refid="class_town_server_1a2260fe99dac49c1843f749554b82fd13" kindref="member">m_kWSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>);</highlight></codeline>
<codeline lineno="909"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ada9f74918ec7e9b670a1f03c8256ee18" kindref="member">m_kNetMgr</ref>.Disconnect(<ref refid="class_town_server_1a74126064d555fe0f5d5b74c28dc6100f" kindref="member">m_kMSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>);</highlight></codeline>
<codeline lineno="910"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ada9f74918ec7e9b670a1f03c8256ee18" kindref="member">m_kNetMgr</ref>.Disconnect(<ref refid="class_town_server_1ae69fd4b0e77ab87dfd1f68d42597285e" kindref="member">m_kWCSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>);</highlight></codeline>
<codeline lineno="911"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1ada9f74918ec7e9b670a1f03c8256ee18" kindref="member">m_kNetMgr</ref>.Disconnect(<ref refid="class_town_server_1aadc054e4ffc82186b7078c1769c8f014" kindref="member">m_kNSData</ref>.<ref refid="struct_se_server_data_1a2777bbfd27a6afe42ebd71c5d14010a0" kindref="member">kSock</ref>);</highlight></codeline>
<codeline lineno="912"><highlight class="normal"></highlight></codeline>
<codeline lineno="913"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(MapAllTcpUser::iterator<sp/>iMapItr<sp/>=<sp/><ref refid="class_town_server_1aceedab403724a01f602711aacc60c736" kindref="member">m_kAllTcpUser</ref>.begin();<sp/>iMapItr<sp/>!=<sp/><ref refid="class_town_server_1aceedab403724a01f602711aacc60c736" kindref="member">m_kAllTcpUser</ref>.end();<sp/>iMapItr++)</highlight></codeline>
<codeline lineno="914"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="915"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_se_t_c_p_user" kindref="compound">SeTCPUser</ref>*<sp/>pkUser<sp/>=<sp/>iMapItr-&gt;second;</highlight></codeline>
<codeline lineno="916"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(NULL<sp/>==<sp/>pkUser)</highlight></codeline>
<codeline lineno="917"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="918"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a59fe2018c00666084724bec1365b41f5" kindref="member">SeLogError</ref>(</highlight><highlight class="stringliteral">&quot;OnTCPSvrDisconnect<sp/>:<sp/>NULL<sp/>==<sp/>pkUser!&quot;</highlight><highlight class="normal">,1);</highlight></codeline>
<codeline lineno="919"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="920"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="921"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pkUser-&gt;<ref refid="struct_se_t_c_p_user_1ac984772dbba350cd8c0f058850c889e1" kindref="member">dwPlayerID</ref><sp/>!=<sp/>0)</highlight></codeline>
<codeline lineno="922"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="923"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_town_server_1af0944b88ad8e0089180769e2f7a1ede4" kindref="member">SendTW_PlayerLeave</ref>(pkUser-&gt;<ref refid="struct_se_t_c_p_user_1ac984772dbba350cd8c0f058850c889e1" kindref="member">dwPlayerID</ref>,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="924"><highlight class="normal"></highlight></codeline>
<codeline lineno="925"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_se_player" kindref="compound">SePlayer</ref>*<sp/>pkPlayer<sp/>=<sp/><ref refid="_src_2_se_player_mgr_8cpp_1abc19838f74a7bdf07c113aab87f5b364" kindref="member">g_kPlayerMgr</ref>.<ref refid="class_se_player_mgr_1a70d89637296c1e7cb23151268bd8468e" kindref="member">GetPlayerByID</ref>(pkUser-&gt;<ref refid="struct_se_t_c_p_user_1ac984772dbba350cd8c0f058850c889e1" kindref="member">dwPlayerID</ref>);</highlight></codeline>
<codeline lineno="926"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pkPlayer)</highlight></codeline>
<codeline lineno="927"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="928"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_se_file_log_8h_1a83f3fe470b91cb8eed8762cc8e5e26c3" kindref="member">SeLogInfo</ref>(<sp/></highlight><highlight class="stringliteral">&quot;Player&lt;-:[%u]<sp/>leave<sp/>town&quot;</highlight><highlight class="normal">,<sp/>pkUser-&gt;<ref refid="struct_se_t_c_p_user_1ac984772dbba350cd8c0f058850c889e1" kindref="member">dwPlayerID</ref>);</highlight></codeline>
<codeline lineno="929"><highlight class="normal"></highlight></codeline>
<codeline lineno="930"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_src_2_se_player_mgr_8cpp_1abc19838f74a7bdf07c113aab87f5b364" kindref="member">g_kPlayerMgr</ref>.<ref refid="class_se_player_mgr_1a670458b0138dd78dbef5a551a0f595a7" kindref="member">DelPlayer</ref>(pkUser-&gt;<ref refid="struct_se_t_c_p_user_1ac984772dbba350cd8c0f058850c889e1" kindref="member">dwPlayerID</ref>);</highlight></codeline>
<codeline lineno="931"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="932"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="933"><highlight class="normal"></highlight></codeline>
<codeline lineno="934"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SeTCPUser::DEL(pkUser);</highlight></codeline>
<codeline lineno="935"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="936"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_town_server_1aceedab403724a01f602711aacc60c736" kindref="member">m_kAllTcpUser</ref>.clear();</highlight></codeline>
<codeline lineno="937"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="F:/TeamWork/ServerVersion/projects/server/Server/Server/TownServer/Src/TownServer.cpp"/>
  </compounddef>
</doxygen>
